<!DOCTYPE html>
<html lang="en">
<head><meta property="og:title" content="Family Business Manager -  Kuse AI"><meta property="og:description" content="Family Business Manager"><meta property="og:url" content="https://www.kuse.ai/pages/Family-Business-Manager/FSAnhz3MqDAPWanH48FtqJ"><meta property="og:type" content="article"><meta property="og:site_name" content="Kuse AI"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Family Business Manager -  Kuse AI"><meta name="twitter:description" content="Family Business Manager"><meta name="twitter:site" content="@kuseHQ"><link rel="canonical" href="https://www.kuse.ai/pages/Family-Business-Manager/FSAnhz3MqDAPWanH48FtqJ"><meta name="description" content="Family Business Manager">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Business Manager -  Kuse AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #475569;
            --accent: #f97316;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        body.dark-mode {
            --primary: #94a3b8;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header h1 {
            font-size: 28px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #334155;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(71, 85, 105, 0.3);
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background: #ea580c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: var(--text);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            background: var(--card);
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--text-light);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            background: var(--bg);
            color: var(--text);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .card-header h2 {
            font-size: 20px;
            color: var(--primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-icon.primary { background: var(--primary); }
        .stat-icon.accent { background: var(--accent); }
        .stat-icon.success { background: var(--success); }
        .stat-icon.warning { background: var(--warning); }

        .stat-info h3 {
            font-size: 32px;
            font-weight: 700;
            color: var(--text);
        }

        .stat-info p {
            color: var(--text-light);
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card);
            padding: 32px;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 24px;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: var(--bg);
            color: var(--text);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            background: var(--card);
            color: var(--text);
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .task-list, .maintenance-list, .bill-list, .contact-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-item, .maintenance-item, .bill-item, .contact-item {
            background: var(--bg);
            padding: 16px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .task-item:hover, .maintenance-item:hover, .bill-item:hover, .contact-item:hover {
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-item.priority-high { border-left-color: var(--danger); }
        .task-item.priority-medium { border-left-color: var(--warning); }
        .task-item.priority-low { border-left-color: var(--success); }
        .task-item.completed { opacity: 0.6; }
        .task-item.completed .task-title { text-decoration: line-through; }

        .task-info, .maintenance-info, .bill-info, .contact-info {
            flex: 1;
        }

        .task-title, .maintenance-title, .bill-title, .contact-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
            color: var(--text);
        }

        .task-meta, .maintenance-meta, .bill-meta, .contact-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 13px;
            color: var(--text-light);
        }

        .task-meta span, .maintenance-meta span, .bill-meta span, .contact-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .task-actions, .maintenance-actions, .bill-actions, .contact-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            color: var(--text-light);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background: var(--card);
            color: var(--text);
        }

        .icon-btn.success:hover { color: var(--success); }
        .icon-btn.danger:hover { color: var(--danger); }

        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            background: var(--card);
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
        }

        .filter-btn:hover {
            border-color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--card);
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideInRight 0.3s;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }
        .toast.info { border-left: 4px solid var(--primary); }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.priority-high { background: #fee2e2; color: var(--danger); }
        .badge.priority-medium { background: #fef3c7; color: var(--warning); }
        .badge.priority-low { background: #d1fae5; color: var(--success); }
        .badge.overdue { background: #fee2e2; color: var(--danger); }
        .badge.due-soon { background: #fef3c7; color: var(--warning); }
        .badge.paid { background: #d1fae5; color: var(--success); }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--success);
        }

        .dark-mode-toggle {
            background: var(--card);
            border: 2px solid var(--border);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text);
            transition: all 0.3s;
        }

        .dark-mode-toggle:hover {
            background: var(--bg);
        }

        .shopping-list-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .shopping-list-card {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
        }

        .shopping-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .shopping-list-header h3 {
            font-size: 18px;
            color: var(--primary);
        }

        .shopping-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: background 0.3s;
        }

        .shopping-item:hover {
            background: var(--card);
        }

        .shopping-item.completed {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .calendar-view {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day {
            aspect-ratio: 1;
            padding: 8px;
            border-radius: 8px;
            background: var(--card);
            display: flex;
            flex-direction: column;
            font-size: 13px;
        }

        .calendar-day-header {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-light);
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
        }

        .event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent);
            margin-top: 2px;
        }

        .budget-chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .expense-table {
            width: 100%;
            border-collapse: collapse;
        }

        .expense-table th,
        .expense-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .expense-table th {
            font-weight: 600;
            color: var(--text-light);
            font-size: 13px;
            text-transform: uppercase;
        }

        .expense-table tr:hover {
            background: var(--bg);
        }

        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-light);
        }

        .how-to-use {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            padding: 24px;
            border-radius: 12px;
            color: white;
            margin-bottom: 24px;
        }

        .how-to-use h3 {
            font-size: 20px;
            margin-bottom: 12px;
        }

        .how-to-use ul {
            list-style: none;
            padding: 0;
        }

        .how-to-use li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .how-to-use li i {
            width: 24px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .header {
                padding: 16px;
            }

            .header h1 {
                font-size: 22px;
            }

            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .task-item, .maintenance-item, .bill-item, .contact-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .task-actions, .maintenance-actions, .bill-actions, .contact-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .shopping-list-grid {
                grid-template-columns: 1fr;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 4px;
            }

            .calendar-day {
                font-size: 11px;
                padding: 4px;
            }

            .modal-content {
                padding: 20px;
            }

            .toast {
                right: 12px;
                bottom: 12px;
                left: 12px;
                max-width: none;
            }
        }

        .kuse-branding {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-light);
            transition: all 0.3s;
            cursor: pointer;
            z-index: 100;
            padding: 8px 12px;
            border-radius: 8px;
            background: var(--card);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .kuse-branding:hover {
            color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .kuse-branding svg {
            height: 1.2em;
        }

        .inbox-container {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .inbox-header {
            text-align: center;
            color: white;
            margin-bottom: 24px;
        }

        .inbox-header h2 {
            font-size: 28px;
            margin-bottom: 8px;
            color: white;
        }

        .inbox-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .inbox-input-area {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .inbox-textarea {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            resize: vertical;
            transition: border-color 0.3s;
            color: var(--text);
            background: var(--bg);
        }

        .inbox-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .inbox-textarea::placeholder {
            color: var(--text-light);
        }

        .inbox-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .inbox-file-input {
            display: none;
        }

        .inbox-file-label {
            padding: 10px 20px;
            border: 2px dashed var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text);
            background: var(--bg);
        }

        .inbox-file-label:hover {
            border-color: var(--primary);
            background: white;
        }

        .inbox-file-label i {
            font-size: 16px;
        }

        .inbox-selected-files {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .inbox-file-tag {
            background: var(--bg);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text);
        }

        .inbox-file-tag i {
            color: var(--accent);
        }

        .inbox-file-tag button {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
        }

        .inbox-file-tag button:hover {
            color: var(--danger);
        }

        .inbox-processing {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--text);
        }

        .inbox-processing.active {
            display: block;
        }

        .inbox-spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .inbox-results {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg);
            border-radius: 8px;
            display: none;
        }

        .inbox-results.active {
            display: block;
        }

        .inbox-result-section {
            margin-bottom: 16px;
        }

        .inbox-result-section h4 {
            font-size: 14px;
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .inbox-result-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inbox-result-item-content {
            flex: 1;
        }

        .inbox-result-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .inbox-result-badge.task { background: #dbeafe; color: #1e40af; }
        .inbox-result-badge.maintenance { background: #fed7aa; color: #c2410c; }
        .inbox-result-badge.bill { background: #fef3c7; color: #92400e; }
        .inbox-result-badge.event { background: #d1fae5; color: #065f46; }
        .inbox-result-badge.shopping { background: #e0e7ff; color: #3730a3; }
        .inbox-result-badge.contact { background: #fce7f3; color: #831843; }
        .inbox-result-badge.expense { background: #fee2e2; color: #991b1b; }

        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .note-card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
            border-left: 4px solid var(--accent);
        }

        .note-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .note-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .note-card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .note-card-date {
            font-size: 12px;
            color: var(--text-light);
        }

        .note-card-content {
            color: var(--text);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 12px;
            max-height: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .note-card-attachments {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .note-attachment-preview {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .note-attachment-preview:hover {
            transform: scale(1.1);
        }

        .note-attachment-file {
            padding: 6px 12px;
            background: var(--bg);
            border-radius: 6px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text);
        }

        .note-card-actions {
            display: flex;
            gap: 8px;
        }

        .note-modal-content {
            max-width: 800px;
        }

        .note-editor {
            width: 100%;
            min-height: 200px;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            resize: vertical;
            color: var(--text);
            background: var(--bg);
        }

        .note-editor:focus {
            outline: none;
            border-color: var(--primary);
        }

        .note-attachments-area {
            margin-top: 16px;
            padding: 16px;
            background: var(--bg);
            border-radius: 8px;
        }

        .note-attachments-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .note-attachment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--card);
            border-radius: 6px;
        }

        .note-attachment-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .note-attachment-thumbnail {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
        }

        .note-attachment-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            font-size: 18px;
        }

        .note-attachment-details {
            flex: 1;
        }

        .note-attachment-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        .note-attachment-size {
            font-size: 12px;
            color: var(--text-light);
        }

        .note-upload-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .note-upload-btn:hover {
            background: #334155;
            transform: translateY(-2px);
        }

        .note-search {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--bg);
            color: var(--text);
        }

        .note-search:focus {
            outline: none;
            border-color: var(--primary);
        }

        .vehicle-card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-left: 4px solid #3b82f6;
        }

        .vehicle-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .vehicle-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .vehicle-card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text);
        }

        .vehicle-card-subtitle {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 4px;
        }

        .vehicle-card-actions {
            display: flex;
            gap: 8px;
        }

        .vehicle-card-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
        }

        .vehicle-info-item {
            font-size: 13px;
        }

        .vehicle-info-label {
            color: var(--text-light);
            margin-bottom: 2px;
        }

        .vehicle-info-value {
            color: var(--text);
            font-weight: 500;
        }

        .maintenance-records-section {
            margin-top: 16px;
        }

        .maintenance-records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .maintenance-records-header h4 {
            font-size: 16px;
            color: var(--text);
        }

        .maintenance-record-item {
            padding: 12px;
            background: var(--bg);
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .maintenance-record-info {
            flex: 1;
        }

        .maintenance-record-date {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .maintenance-record-odometer {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .maintenance-record-description {
            font-size: 13px;
            color: var(--text);
            line-height: 1.4;
        }

        .maintenance-record-actions {
            display: flex;
            gap: 4px;
        }

        .gcal-sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            background: var(--bg);
        }

        .gcal-sync-status.connected {
            color: var(--success);
        }

        .gcal-sync-status.disconnected {
            color: var(--text-light);
        }

        .gcal-sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-light);
        }

        .gcal-sync-indicator.active {
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .gcal-setup-card {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            padding: 24px;
            border-radius: 12px;
            color: white;
            margin-bottom: 20px;
        }

        .gcal-setup-card h3 {
            margin-bottom: 12px;
            color: white;
        }

        .gcal-setup-card p {
            margin-bottom: 16px;
            opacity: 0.9;
        }

        .gcal-setup-card ol {
            margin-bottom: 16px;
            padding-left: 20px;
        }

        .gcal-setup-card li {
            margin-bottom: 8px;
        }

        .gcal-setup-card code {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .gcal-config-input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .gcal-config-input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .gcal-config-input:focus {
            outline: none;
            border-color: rgba(255,255,255,0.6);
            background: rgba(255,255,255,0.15);
        }

        @media print {
            .header-actions, .tabs, .btn, .icon-btn, .kuse-branding {
                display: none !important;
            }
        }
    </style>
<script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Family Business Manager -  Kuse AI","description":"Family Business Manager","url":"https://www.kuse.ai/pages/Family-Business-Manager/FSAnhz3MqDAPWanH48FtqJ","author":{"@type":"Organization","name":"Kuse AI"},"publisher":{"@type":"Organization","name":"Kuse AI","url":"https://www.kuse.ai"},"inLanguage":"en","alternateName":"Family Business Manager"}</script></head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <i class="fas fa-home"></i>
                Family Business Manager
            </h1>
            <div class="header-actions">
                <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn btn-secondary btn-sm" onclick="exportData()">
                    <i class="fas fa-download"></i> Export
                </button>
                <button class="btn btn-secondary btn-sm" onclick="document.getElementById('importFile').click()">
                    <i class="fas fa-upload"></i> Import
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">
                <i class="fas fa-chart-line"></i> Dashboard
            </button>
            <button class="tab" onclick="switchTab('tasks')">
                <i class="fas fa-tasks"></i> Tasks
            </button>
            <button class="tab" onclick="switchTab('maintenance')">
                <i class="fas fa-tools"></i> Maintenance
            </button>

            <button class="tab" onclick="switchTab('schedule')">
                <i class="fas fa-calendar-alt"></i> Schedule
            </button>
            <button class="tab" onclick="switchTab('shopping')">
                <i class="fas fa-shopping-cart"></i> Shopping
            </button>
            <button class="tab" onclick="switchTab('contacts')">
                <i class="fas fa-address-book"></i> Contacts
            </button>
            <button class="tab" onclick="switchTab('vehicles')">
                <i class="fas fa-car"></i> Vehicles
            </button>
            <button class="tab" onclick="switchTab('notes')">
                <i class="fas fa-sticky-note"></i> Notes
            </button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="inbox-container">
                <div class="inbox-header">
                    <h2><i class="fas fa-inbox"></i> Family Inbox</h2>
                    <p>Type, paste, or upload anything - we'll organize it for you automatically</p>
                </div>
                <div class="inbox-input-area">
                    <textarea 
                        id="inboxTextarea" 
                        class="inbox-textarea" 
                        placeholder="Type or paste anything here... 

Examples:
• 'Remind Alex to take out trash on Thursday'
• 'Electric bill $120 due on the 15th'
• 'Oil change for Honda due in 2 weeks'
• 'Parent-teacher conference next Monday at 3pm'
• 'Buy milk, eggs, and bread'"></textarea>
                    
                    <div class="inbox-actions">
                        <button class="btn btn-primary" onclick="processInbox()">
                            <i class="fas fa-magic"></i> Process Inbox
                        </button>
                        
                        <label for="inboxVoiceFile" class="inbox-file-label">
                            <i class="fas fa-microphone"></i> Upload Voice
                        </label>
                        <input type="file" id="inboxVoiceFile" class="inbox-file-input" accept="audio/*" onchange="handleInboxFile(event, 'voice')">
                        
                        <label for="inboxDocFile" class="inbox-file-label">
                            <i class="fas fa-file-alt"></i> Upload Document
                        </label>
                        <input type="file" id="inboxDocFile" class="inbox-file-input" accept=".txt,.doc,.docx,.pdf" onchange="handleInboxFile(event, 'document')">
                        
                        <button class="btn btn-secondary btn-sm" onclick="clearInbox()">
                            <i class="fas fa-eraser"></i> Clear
                        </button>
                    </div>
                    
                    <div id="inboxSelectedFiles" class="inbox-selected-files"></div>
                    
                    <div id="inboxProcessing" class="inbox-processing">
                        <div class="inbox-spinner"></div>
                        <p>Processing your input...</p>
                    </div>
                    
                    <div id="inboxResults" class="inbox-results"></div>
                </div>
            </div>

            <div class="how-to-use">
                <h3><i class="fas fa-lightbulb"></i> How to Use This Dashboard</h3>
                <ul>
                    <li><i class="fas fa-inbox"></i> Use the Inbox above to quickly add tasks, bills, events, and more</li>
                    <li><i class="fas fa-check-circle"></i> Navigate between sections using the tabs above</li>
                    <li><i class="fas fa-plus-circle"></i> Add new items using the "Add" buttons in each section</li>
                    <li><i class="fas fa-filter"></i> Use filters to quickly find what you need</li>
                    <li><i class="fas fa-download"></i> Export your data regularly for backup</li>
                    <li><i class="fas fa-moon"></i> Toggle dark mode for comfortable viewing</li>
                </ul>
            </div>

            <div class="card">
                <h2 style="margin-bottom: 8px;">Welcome back!</h2>
                <p style="color: var(--text-light); margin-bottom: 24px;" id="currentDate"></p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="tasksToday">0</h3>
                            <p>Tasks Due Today</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="upcomingBills">0</h3>
                            <p>Bills This Week</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon accent">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="maintenanceDue">0</h3>
                            <p>Maintenance Due</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="eventsToday">0</h3>
                            <p>Events Today</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-clock"></i> Recent Activity</h2>
                </div>
                <div class="activity-feed" id="activityFeed"></div>
            </div>
        </div>

        <div id="tasks" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-tasks"></i> Task Management</h2>
                    <button class="btn btn-primary" onclick="openTaskModal()">
                        <i class="fas fa-plus"></i> Add Task
                    </button>
                </div>

                <div class="filters">
                    <button class="filter-btn active" onclick="filterTasks('all')">All</button>
                    <button class="filter-btn" onclick="filterTasks('today')">Today</button>
                    <button class="filter-btn" onclick="filterTasks('week')">This Week</button>
                    <button class="filter-btn" onclick="filterTasks('overdue')">Overdue</button>
                    <select class="filter-btn" onchange="filterTasksByAssignee(this.value)" style="cursor: pointer;">
                        <option value="all">All Members</option>
                    </select>
                </div>

                <div class="task-list" id="taskList"></div>
            </div>
        </div>

        <div id="maintenance" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-tools"></i> Maintenance Tracker</h2>
                    <button class="btn btn-primary" onclick="openMaintenanceModal()">
                        <i class="fas fa-plus"></i> Add Maintenance
                    </button>
                </div>

                <div class="filters">
                    <button class="filter-btn active" onclick="filterMaintenance('all')">All</button>
                    <button class="filter-btn" onclick="filterMaintenance('home')">Home</button>
                    <button class="filter-btn" onclick="filterMaintenance('vehicle')">Vehicle</button>
                    <button class="filter-btn" onclick="filterMaintenance('yard')">Yard</button>
                    <button class="filter-btn" onclick="filterMaintenance('appliances')">Appliances</button>
                </div>

                <div class="maintenance-list" id="maintenanceList"></div>
            </div>
        </div>



        <div id="schedule" class="tab-content">
            <div id="gcalSetupCard" class="gcal-setup-card" style="display: none;">
                <h3><i class="fab fa-google"></i> Connect Google Calendar</h3>
                <p>Sync your family events with Google Calendar for automatic updates across all devices!</p>
                
                <div style="margin-bottom: 16px;">
                    <strong>Quick Setup (5 minutes):</strong>
                    <ol>
                        <li>Go to <a href="https://console.cloud.google.com/" target="_blank" style="color: white; text-decoration: underline;">Google Cloud Console</a></li>
                        <li>Create a new project (or select existing)</li>
                        <li>Enable "Google Calendar API"</li>
                        <li>Go to "Credentials" → Create OAuth 2.0 Client ID</li>
                        <li>Add <code>http://localhost</code> and your domain to authorized origins</li>
                        <li>Copy your Client ID and paste below:</li>
                    </ol>
                </div>

                <input 
                    type="text" 
                    id="gcalClientId" 
                    class="gcal-config-input" 
                    placeholder="Paste your Google Calendar Client ID here..."
                    value="">
                
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-primary" onclick="saveGoogleCalendarConfig()" style="background: white; color: #4285f4;">
                        <i class="fas fa-save"></i> Save & Connect
                    </button>
                    <button class="btn btn-secondary" onclick="hideGcalSetup()" style="background: rgba(255,255,255,0.2); color: white;">
                        Skip for Now
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-calendar-alt"></i> Family Schedule</h2>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div id="gcalSyncStatus" class="gcal-sync-status disconnected">
                            <div class="gcal-sync-indicator"></div>
                            <span>Google Calendar: Disconnected</span>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="toggleGoogleCalendarSync()" id="gcalSyncButton">
                            <i class="fab fa-google"></i> Connect Google
                        </button>
                        <button class="btn btn-primary" onclick="openEventModal()">
                            <i class="fas fa-plus"></i> Add Event
                        </button>
                    </div>
                </div>

                <div class="calendar-view">
                    <div class="calendar-header">
                        <button class="btn btn-secondary btn-sm" onclick="previousMonth()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="calendarMonth"></h3>
                        <button class="btn btn-secondary btn-sm" onclick="nextMonth()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <div style="margin-top: 24px;">
                    <h3 style="margin-bottom: 16px;">Upcoming Events</h3>
                    <div id="eventList"></div>
                </div>
            </div>
        </div>

        <div id="shopping" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-shopping-cart"></i> Shopping Lists</h2>
                </div>

                <div class="shopping-list-grid">
                    <div class="shopping-list-card">
                        <div class="shopping-list-header">
                            <h3><i class="fas fa-shopping-basket"></i> Groceries</h3>
                            <button class="btn btn-sm btn-primary" onclick="openShoppingModal('groceries')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="groceriesList"></div>
                        <button class="btn btn-sm btn-secondary" style="width: 100%; margin-top: 12px;" onclick="clearCompleted('groceries')">
                            Clear Completed
                        </button>
                    </div>

                    <div class="shopping-list-card">
                        <div class="shopping-list-header">
                            <h3><i class="fas fa-hammer"></i> Hardware</h3>
                            <button class="btn btn-sm btn-primary" onclick="openShoppingModal('hardware')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="hardwareList"></div>
                        <button class="btn btn-sm btn-secondary" style="width: 100%; margin-top: 12px;" onclick="clearCompleted('hardware')">
                            Clear Completed
                        </button>
                    </div>

                    <div class="shopping-list-card">
                        <div class="shopping-list-header">
                            <h3><i class="fas fa-pills"></i> Pharmacy</h3>
                            <button class="btn btn-sm btn-primary" onclick="openShoppingModal('pharmacy')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="pharmacyList"></div>
                        <button class="btn btn-sm btn-secondary" style="width: 100%; margin-top: 12px;" onclick="clearCompleted('pharmacy')">
                            Clear Completed
                        </button>
                    </div>

                    <div class="shopping-list-card">
                        <div class="shopping-list-header">
                            <h3><i class="fas fa-ellipsis-h"></i> Other</h3>
                            <button class="btn btn-sm btn-primary" onclick="openShoppingModal('other')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="otherList"></div>
                        <button class="btn btn-sm btn-secondary" style="width: 100%; margin-top: 12px;" onclick="clearCompleted('other')">
                            Clear Completed
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="contacts" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-address-book"></i> Important Contacts</h2>
                    <button class="btn btn-primary" onclick="openContactModal()">
                        <i class="fas fa-plus"></i> Add Contact
                    </button>
                </div>

                <div class="filters">
                    <button class="filter-btn active" onclick="filterContacts('all')">All</button>
                    <button class="filter-btn" onclick="filterContacts('emergency')">Emergency</button>
                    <button class="filter-btn" onclick="filterContacts('medical')">Medical</button>
                    <button class="filter-btn" onclick="filterContacts('home-services')">Home Services</button>
                    <button class="filter-btn" onclick="filterContacts('school')">School</button>
                    <button class="filter-btn" onclick="filterContacts('utilities')">Utilities</button>
                </div>

                <div class="contact-list" id="contactList"></div>
            </div>
        </div>

        <div id="notes" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-sticky-note"></i> Notes</h2>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="text" id="noteSearch" class="note-search" placeholder="Search notes..." onkeyup="searchNotes()">
                        <button class="btn btn-primary" onclick="openNoteModal()">
                            <i class="fas fa-plus"></i> New Note
                        </button>
                    </div>
                </div>

                <div class="notes-grid" id="notesGrid"></div>
            </div>
        </div>

        <div id="vehicles" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-car"></i> Vehicle Management</h2>
                    <button class="btn btn-primary" onclick="openVehicleModal()">
                        <i class="fas fa-plus"></i> Add Vehicle
                    </button>
                </div>

                <div class="notes-grid" id="vehiclesGrid"></div>
            </div>
        </div>
    </div>

    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="taskModalTitle">Add Task</h2>
                <button class="close-modal" onclick="closeModal('taskModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="taskForm" onsubmit="saveTask(event)">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label>Task Title *</label>
                    <input type="text" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="taskDescription"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Assignee *</label>
                        <select id="taskAssignee" required></select>
                    </div>
                    <div class="form-group">
                        <label>Due Date *</label>
                        <input type="date" id="taskDueDate" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Priority *</label>
                        <select id="taskPriority" required>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Recurring</label>
                        <select id="taskRecurring">
                            <option value="none">None</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Task</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('taskModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="maintenanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Maintenance Item</h2>
                <button class="close-modal" onclick="closeModal('maintenanceModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="maintenanceForm" onsubmit="saveMaintenance(event)">
                <input type="hidden" id="maintenanceId">
                <div class="form-group">
                    <label>Item Name *</label>
                    <input type="text" id="maintenanceName" required>
                </div>
                <div class="form-group">
                    <label>Category *</label>
                    <select id="maintenanceCategory" required>
                        <option value="home">Home</option>
                        <option value="vehicle">Vehicle</option>
                        <option value="yard">Yard</option>
                        <option value="appliances">Appliances</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Last Completed</label>
                        <input type="date" id="maintenanceLastDate">
                    </div>
                    <div class="form-group">
                        <label>Frequency (months) *</label>
                        <input type="number" id="maintenanceFrequency" min="1" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Estimated Cost</label>
                        <input type="number" id="maintenanceCost" step="0.01" placeholder="0.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="maintenanceNotes"></textarea>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Item</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('maintenanceModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="vehicleModalTitle">Add Vehicle</h2>
                <button class="close-modal" onclick="closeModal('vehicleModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="vehicleForm" onsubmit="saveVehicle(event)">
                <input type="hidden" id="vehicleId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Year *</label>
                        <input type="number" id="vehicleYear" required min="1900" max="2100" placeholder="2020">
                    </div>
                    <div class="form-group">
                        <label>Make *</label>
                        <input type="text" id="vehicleMake" required placeholder="Honda">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Model *</label>
                        <input type="text" id="vehicleModel" required placeholder="Civic">
                    </div>
                    <div class="form-group">
                        <label>Color</label>
                        <input type="text" id="vehicleColor" placeholder="Silver">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>VIN</label>
                        <input type="text" id="vehicleVin" placeholder="1HGBH41JXMN109186">
                    </div>
                    <div class="form-group">
                        <label>License Plate</label>
                        <input type="text" id="vehiclePlate" placeholder="ABC-1234">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="vehicleNotes" placeholder="Any additional information..."></textarea>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Vehicle</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('vehicleModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="maintenanceRecordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Maintenance Record</h2>
                <button class="close-modal" onclick="closeModal('maintenanceRecordModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="maintenanceRecordForm" onsubmit="saveMaintenanceRecord(event)">
                <input type="hidden" id="maintenanceRecordVehicleId">
                <input type="hidden" id="maintenanceRecordId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="maintenanceRecordDate" required>
                    </div>
                    <div class="form-group">
                        <label>Odometer Reading *</label>
                        <input type="number" id="maintenanceRecordOdometer" required placeholder="50000">
                    </div>
                </div>
                <div class="form-group">
                    <label>Description *</label>
                    <textarea id="maintenanceRecordDescription" required placeholder="Oil change, tire rotation, etc."></textarea>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Record</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('maintenanceRecordModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="billModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Bill</h2>
                <button class="close-modal" onclick="closeModal('billModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="billForm" onsubmit="saveBill(event)">
                <input type="hidden" id="billId">
                <div class="form-group">
                    <label>Bill Name *</label>
                    <input type="text" id="billName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Amount *</label>
                        <input type="number" id="billAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Due Date *</label>
                        <input type="date" id="billDueDate" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Recurring</label>
                        <select id="billRecurring" onchange="toggleBillFrequency()">
                            <option value="no">No</option>
                            <option value="yes">Yes</option>
                        </select>
                    </div>
                    <div class="form-group" id="billFrequencyGroup" style="display: none;">
                        <label>Frequency</label>
                        <select id="billFrequency">
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <input type="text" id="billPaymentMethod" placeholder="e.g., Auto-pay, Check">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="billNotes"></textarea>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Bill</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('billModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Event</h2>
                <button class="close-modal" onclick="closeModal('eventModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="eventForm" onsubmit="saveEvent(event)">
                <input type="hidden" id="eventId">
                <div class="form-group">
                    <label>Event Name *</label>
                    <input type="text" id="eventName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="eventTime">
                    </div>
                </div>
                <div class="form-group">
                    <label>Family Member(s)</label>
                    <select id="eventMembers" multiple style="height: 100px;">
                    </select>
                    <small style="color: var(--text-light);">Hold Ctrl/Cmd to select multiple</small>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="eventLocation">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="eventNotes"></textarea>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Event</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('eventModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="shoppingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Shopping Item</h2>
                <button class="close-modal" onclick="closeModal('shoppingModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="shoppingForm" onsubmit="saveShoppingItem(event)">
                <input type="hidden" id="shoppingCategory">
                <div class="form-group">
                    <label>Item Name *</label>
                    <input type="text" id="shoppingItemName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="text" id="shoppingQuantity" placeholder="e.g., 2, 1 lb">
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="shoppingPriority">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Add Item</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('shoppingModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Contact</h2>
                <button class="close-modal" onclick="closeModal('contactModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="contactForm" onsubmit="saveContact(event)">
                <input type="hidden" id="contactId">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="contactName" required>
                </div>
                <div class="form-group">
                    <label>Category *</label>
                    <select id="contactCategory" required>
                        <option value="emergency">Emergency</option>
                        <option value="medical">Medical</option>
                        <option value="home-services">Home Services</option>
                        <option value="school">School</option>
                        <option value="utilities">Utilities</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="contactPhone">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="contactEmail">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="contactNotes"></textarea>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Contact</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('contactModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="noteModal" class="modal">
        <div class="modal-content note-modal-content">
            <div class="modal-header">
                <h2 id="noteModalTitle">New Note</h2>
                <button class="close-modal" onclick="closeModal('noteModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="noteForm" onsubmit="saveNote(event)">
                <input type="hidden" id="noteId">
                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" id="noteTitle" required placeholder="Enter note title...">
                </div>
                <div class="form-group">
                    <label>Content</label>
                    <textarea id="noteContent" class="note-editor" placeholder="Write your note here..."></textarea>
                </div>
                <div class="note-attachments-area">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label style="margin: 0;"><i class="fas fa-paperclip"></i> Attachments</label>
                        <button type="button" class="note-upload-btn" onclick="document.getElementById('noteAttachmentInput').click()">
                            <i class="fas fa-upload"></i> Upload Files
                        </button>
                        <input type="file" id="noteAttachmentInput" style="display: none;" multiple accept="image/*,.pdf,.doc,.docx,.txt" onchange="handleNoteAttachments(event)">
                    </div>
                    <div id="noteAttachmentsList" class="note-attachments-list"></div>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Note</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('noteModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Expense</h2>
                <button class="close-modal" onclick="closeModal('expenseModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="expenseForm" onsubmit="saveExpense(event)">
                <input type="hidden" id="expenseId">
                <div class="form-group">
                    <label>Description *</label>
                    <input type="text" id="expenseDescription" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Amount *</label>
                        <input type="number" id="expenseAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Category *</label>
                    <select id="expenseCategory" required>
                        <option value="housing">Housing</option>
                        <option value="utilities">Utilities</option>
                        <option value="food">Food</option>
                        <option value="transportation">Transportation</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="savings">Savings</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Expense</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('expenseModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <a href="https://kuse.ai" target="_blank" class="kuse-branding">
        <span>made with</span>
        <svg viewBox="0,0,160,44" xmlns="http://www.w3.org/2000/svg"><path d="m.01,20.65C-.43,8.25,9.3-2.03,22.04.34,34.78,2.72,43.29,8.32,43.29,22.9s-8.66,19.01-22.03,20.3C7.9,44.5.46,33.05.01,20.65z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="m146.76,7.94c8.07,0,13.24,6.15,13.24,14.58v1.39h-20.75c.45,4.05,3.51,7.37,8.57,7.37,2.62,0,5.73-1.05,7.62-2.94l2.67,3.83c-2.67,2.55-6.62,3.88-10.9,3.88-8.07,0-14.08-5.6-14.08-14.08,0-7.76,5.67-14.02,13.63-14.02zm0,4.77c-5.01,0-7.29,3.83-7.57,7.1h15.13c-.11-3.16-2.28-7.1-7.57-7.1z" fill="currentColor"/><path d="m86.64,24.49c0,4.15,2.39,6.84,6.84,6.84,4.4,0,6.84-2.69,6.84-6.84V8.55h5.37v16.33c0,6.7-4.06,11.14-12.21,11.14-8.21,0-12.21-4.5-12.21-11.09V8.55h5.37v15.94zm32.99-16.55c4.49,0,8.06,1.47,10.6,3.86l-2.59,3.81c-2.05-2-5.28-3.08-8.06-3.08-2.88,0-4.84,1.37-4.84,3.32,0,1.91,2.64,2.54,5.81,3.27,4.59,1.08,10.26,2.4,10.26,8.46,0,4.94-3.76,8.41-11.14,8.41-4.98,0-8.94-1.76-11.24-4.11l2.54-4.11c1.86,1.91,5.18,3.67,8.84,3.67,3.91,0,5.57-1.66,5.57-3.62,0-2.3-2.88-2.98-6.21-3.76-4.54-1.08-9.87-2.3-9.87-8.06,0-4.5,4.2-8.06,10.31-8.06zM60.79,20.82,71.44,8.55h6.5L66.46,21.26,78.82,35.44h-6.5l-9.28-11.1-2.25,2.49v8.6h-5.33V8.55h5.33v12.27z" fill="currentColor"/></svg>
    </a>

    <script src="https://cdn.kuse.ai/sdk.prd.js"></script>
    <script>
        let data = {
            tasks: [],
            maintenance: [],
            bills: [],
            events: [],
            shoppingLists: {
                groceries: [],
                hardware: [],
                pharmacy: [],
                other: []
            },
            contacts: [],
            expenses: [],
            notes: [],
            vehicles: [],
            familyMembers: [`Mom`, `Dad`, `Alex`, `Sam`],
            monthlyIncome: 0,
            activities: []
        };

        let currentNoteAttachments = [];

        let currentMonth = new Date();
        let currentFilter = {
            tasks: `all`,
            maintenance: `all`,
            bills: `upcoming`,
            contacts: `all`
        };
        let budgetChart = null;

        function init() {
            loadData();
            initializeSampleData();
            updateCurrentDate();
            populateFamilyMembers();
            renderDashboard();
            renderTasks();
            renderMaintenance();
            renderBills();
            renderCalendar();
            renderShoppingLists();
            renderContacts();
            renderBudget();
            renderActivityFeed();
            renderNotes();
            renderVehicles();
        }

        function loadData() {
            const savedData = localStorage.getItem(`familyBusinessData`);
            if (savedData) {
                data = JSON.parse(savedData);
                // Ensure vehicles array exists for backward compatibility
                if (!data.vehicles) {
                    data.vehicles = [];
                }
                // Ensure notes array exists for backward compatibility
                if (!data.notes) {
                    data.notes = [];
                }
            }
        }

        function saveData() {
            localStorage.setItem(`familyBusinessData`, JSON.stringify(data));
        }

        function initializeSampleData() {
            if (data.tasks.length === 0) {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const nextWeek = new Date(today);
                nextWeek.setDate(nextWeek.getDate() + 7);

                data.tasks = [
                    {
                        id: Date.now(),
                        title: `Take out trash`,
                        description: `Weekly trash collection day`,
                        assignee: `Alex`,
                        dueDate: today.toISOString().split(`T`)[0],
                        priority: `medium`,
                        recurring: `weekly`,
                        completed: false,
                        createdAt: Date.now()
                    },
                    {
                        id: Date.now() + 1,
                        title: `Grocery shopping`,
                        description: `Weekly grocery run`,
                        assignee: `Mom`,
                        dueDate: tomorrow.toISOString().split(`T`)[0],
                        priority: `high`,
                        recurring: `weekly`,
                        completed: false,
                        createdAt: Date.now()
                    },
                    {
                        id: Date.now() + 2,
                        title: `Mow the lawn`,
                        description: `Front and back yard`,
                        assignee: `Dad`,
                        dueDate: nextWeek.toISOString().split(`T`)[0],
                        priority: `low`,
                        recurring: `weekly`,
                        completed: false,
                        createdAt: Date.now()
                    }
                ];

                const lastMonth = new Date(today);
                lastMonth.setMonth(lastMonth.getMonth() - 2);
                const twoMonthsAgo = new Date(today);
                twoMonthsAgo.setMonth(twoMonthsAgo.getMonth() - 4);

                data.maintenance = [
                    {
                        id: Date.now(),
                        name: `HVAC Filter Change`,
                        category: `home`,
                        lastCompleted: lastMonth.toISOString().split(`T`)[0],
                        frequency: 3,
                        cost: 25,
                        notes: `Replace with 16x25x1 filter`,
                        createdAt: Date.now()
                    },
                    {
                        id: Date.now() + 1,
                        name: `Car Oil Change`,
                        category: `vehicle`,
                        lastCompleted: twoMonthsAgo.toISOString().split(`T`)[0],
                        frequency: 3,
                        cost: 45,
                        notes: `Honda Civic - 5W-30 synthetic`,
                        createdAt: Date.now()
                    }
                ];

                const bill1Date = new Date(today);
                bill1Date.setDate(15);
                const bill2Date = new Date(today);
                bill2Date.setDate(1);

                data.bills = [
                    {
                        id: Date.now(),
                        name: `Electric Bill`,
                        amount: 120,
                        dueDate: bill1Date.toISOString().split(`T`)[0],
                        recurring: `yes`,
                        frequency: `monthly`,
                        paymentMethod: `Auto-pay`,
                        notes: ``,
                        paid: false,
                        createdAt: Date.now()
                    },
                    {
                        id: Date.now() + 1,
                        name: `Internet Service`,
                        amount: 79.99,
                        dueDate: bill2Date.toISOString().split(`T`)[0],
                        recurring: `yes`,
                        frequency: `monthly`,
                        paymentMethod: `Credit Card`,
                        notes: ``,
                        paid: false,
                        createdAt: Date.now()
                    }
                ];

                const event1Date = new Date(today);
                event1Date.setDate(event1Date.getDate() + 3);

                data.events = [
                    {
                        id: Date.now(),
                        name: `Parent-Teacher Conference`,
                        date: event1Date.toISOString().split(`T`)[0],
                        time: `15:30`,
                        members: [`Mom`, `Dad`],
                        location: `Lincoln Elementary School`,
                        notes: `Discuss Alex's progress`,
                        createdAt: Date.now()
                    }
                ];

                data.contacts = [
                    {
                        id: Date.now(),
                        name: `Dr. Sarah Johnson`,
                        category: `medical`,
                        phone: `555-0123`,
                        email: `sjohnson@clinic.com`,
                        notes: `Family physician`,
                        createdAt: Date.now()
                    },
                    {
                        id: Date.now() + 1,
                        name: `Emergency Services`,
                        category: `emergency`,
                        phone: `911`,
                        email: ``,
                        notes: `Police, Fire, Ambulance`,
                        createdAt: Date.now()
                    },
                    {
                        id: Date.now() + 2,
                        name: `Joe's Plumbing`,
                        category: `home-services`,
                        phone: `555-0456`,
                        email: `joe@plumbing.com`,
                        notes: `Available 24/7`,
                        createdAt: Date.now()
                    },
                    {
                        id: Date.now() + 3,
                        name: `Lincoln Elementary`,
                        category: `school`,
                        phone: `555-0789`,
                        email: `office@lincoln.edu`,
                        notes: `School office hours: 8am-4pm`,
                        createdAt: Date.now()
                    }
                ];

                data.shoppingLists.groceries = [
                    { id: Date.now(), name: `Milk`, quantity: `1 gallon`, priority: `high`, completed: false },
                    { id: Date.now() + 1, name: `Bread`, quantity: `2 loaves`, priority: `medium`, completed: false },
                    { id: Date.now() + 2, name: `Eggs`, quantity: `1 dozen`, priority: `high`, completed: false }
                ];

                saveData();
            }
        }

        function updateCurrentDate() {
            const options = { weekday: `long`, year: `numeric`, month: `long`, day: `numeric` };
            document.getElementById(`currentDate`).textContent = new Date().toLocaleDateString(`en-US`, options);
        }

        function populateFamilyMembers() {
            const selects = [`taskAssignee`, `eventMembers`];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = ``;
                data.familyMembers.forEach(member => {
                    const option = document.createElement(`option`);
                    option.value = member;
                    option.textContent = member;
                    select.appendChild(option);
                });
            });

            const assigneeFilter = document.querySelector(`.filters select`);
            if (assigneeFilter) {
                assigneeFilter.innerHTML = `<option value="all">All Members</option>`;
                data.familyMembers.forEach(member => {
                    const option = document.createElement(`option`);
                    option.value = member;
                    option.textContent = member;
                    assigneeFilter.appendChild(option);
                });
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll(`.tab`).forEach(tab => tab.classList.remove(`active`));
            document.querySelectorAll(`.tab-content`).forEach(content => content.classList.remove(`active`));
            
            event.target.closest(`.tab`).classList.add(`active`);
            document.getElementById(tabName).classList.add(`active`);

            if (tabName === `schedule`) {
                renderCalendar();
            } else if (tabName === `budget`) {
                renderBudget();
            }
        }

        function renderDashboard() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const tasksToday = data.tasks.filter(task => {
                const dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                return !task.completed && dueDate.getTime() === today.getTime();
            }).length;

            const weekFromNow = new Date(today);
            weekFromNow.setDate(weekFromNow.getDate() + 7);

            const upcomingBills = data.bills.filter(bill => {
                const dueDate = new Date(bill.dueDate);
                return !bill.paid && dueDate >= today && dueDate <= weekFromNow;
            }).length;

            const maintenanceDue = data.maintenance.filter(item => {
                if (!item.lastCompleted) return true;
                const lastDate = new Date(item.lastCompleted);
                const nextDue = new Date(lastDate);
                nextDue.setMonth(nextDue.getMonth() + parseInt(item.frequency));
                return nextDue <= today;
            }).length;

            const eventsToday = data.events.filter(event => {
                const eventDate = new Date(event.date);
                eventDate.setHours(0, 0, 0, 0);
                return eventDate.getTime() === today.getTime();
            }).length;

            document.getElementById(`tasksToday`).textContent = tasksToday;
            document.getElementById(`upcomingBills`).textContent = upcomingBills;
            document.getElementById(`maintenanceDue`).textContent = maintenanceDue;
            document.getElementById(`eventsToday`).textContent = eventsToday;
        }

        function renderActivityFeed() {
            const feed = document.getElementById(`activityFeed`);
            
            if (data.activities.length === 0) {
                feed.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <h3>No recent activity</h3>
                        <p>Your activity will appear here as you use the dashboard</p>
                    </div>
                `;
                return;
            }

            const recentActivities = data.activities.slice(-10).reverse();
            
            feed.innerHTML = recentActivities.map(activity => {
                const timeAgo = getTimeAgo(activity.timestamp);
                const iconClass = getActivityIcon(activity.type);
                const colorClass = getActivityColor(activity.type);
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${colorClass}">
                            <i class="${iconClass}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">${activity.text}</div>
                            <div class="activity-time">${timeAgo}</div>
                        </div>
                    </div>
                `;
            }).join(``);
        }

        function addActivity(type, text) {
            data.activities.push({
                type,
                text,
                timestamp: Date.now()
            });
            saveData();
            renderActivityFeed();
        }

        function getActivityIcon(type) {
            const icons = {
                task: `fas fa-tasks`,
                maintenance: `fas fa-tools`,
                bill: `fas fa-file-invoice-dollar`,
                event: `fas fa-calendar-alt`,
                shopping: `fas fa-shopping-cart`,
                contact: `fas fa-address-book`,
                expense: `fas fa-wallet`
            };
            return icons[type] || `fas fa-circle`;
        }

        function getActivityColor(type) {
            const colors = {
                task: `primary`,
                maintenance: `accent`,
                bill: `warning`,
                event: `success`,
                shopping: `primary`,
                contact: `accent`,
                expense: `warning`
            };
            return colors[type] || `primary`;
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            
            if (seconds < 60) return `Just now`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        function openTaskModal(taskId = null) {
            const modal = document.getElementById(`taskModal`);
            const form = document.getElementById(`taskForm`);
            form.reset();
            
            if (taskId) {
                const task = data.tasks.find(t => t.id === taskId);
                if (task) {
                    document.getElementById(`taskModalTitle`).textContent = `Edit Task`;
                    document.getElementById(`taskId`).value = task.id;
                    document.getElementById(`taskTitle`).value = task.title;
                    document.getElementById(`taskDescription`).value = task.description;
                    document.getElementById(`taskAssignee`).value = task.assignee;
                    document.getElementById(`taskDueDate`).value = task.dueDate;
                    document.getElementById(`taskPriority`).value = task.priority;
                    document.getElementById(`taskRecurring`).value = task.recurring;
                }
            } else {
                document.getElementById(`taskModalTitle`).textContent = `Add Task`;
                document.getElementById(`taskId`).value = ``;
                const today = new Date().toISOString().split(`T`)[0];
                document.getElementById(`taskDueDate`).value = today;
            }
            
            modal.classList.add(`active`);
        }

        function saveTask(e) {
            e.preventDefault();
            
            const taskId = document.getElementById(`taskId`).value;
            const task = {
                id: taskId ? parseInt(taskId) : Date.now(),
                title: document.getElementById(`taskTitle`).value,
                description: document.getElementById(`taskDescription`).value,
                assignee: document.getElementById(`taskAssignee`).value,
                dueDate: document.getElementById(`taskDueDate`).value,
                priority: document.getElementById(`taskPriority`).value,
                recurring: document.getElementById(`taskRecurring`).value,
                completed: false,
                createdAt: taskId ? data.tasks.find(t => t.id === parseInt(taskId)).createdAt : Date.now()
            };

            if (taskId) {
                const index = data.tasks.findIndex(t => t.id === parseInt(taskId));
                data.tasks[index] = task;
                addActivity(`task`, `Updated task: ${task.title}`);
            } else {
                data.tasks.push(task);
                addActivity(`task`, `Added new task: ${task.title}`);
            }

            saveData();
            renderTasks();
            renderDashboard();
            closeModal(`taskModal`);
            showToast(`Task saved successfully!`, `success`);
        }

        function renderTasks() {
            const taskList = document.getElementById(`taskList`);
            let filteredTasks = [...data.tasks];

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            switch (currentFilter.tasks) {
                case `today`:
                    filteredTasks = filteredTasks.filter(task => {
                        const dueDate = new Date(task.dueDate);
                        dueDate.setHours(0, 0, 0, 0);
                        return dueDate.getTime() === today.getTime();
                    });
                    break;
                case `week`:
                    const weekFromNow = new Date(today);
                    weekFromNow.setDate(weekFromNow.getDate() + 7);
                    filteredTasks = filteredTasks.filter(task => {
                        const dueDate = new Date(task.dueDate);
                        return dueDate >= today && dueDate <= weekFromNow;
                    });
                    break;
                case `overdue`:
                    filteredTasks = filteredTasks.filter(task => {
                        const dueDate = new Date(task.dueDate);
                        return !task.completed && dueDate < today;
                    });
                    break;
            }

            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks"></i>
                        <h3>No tasks found</h3>
                        <p>Add a new task to get started</p>
                    </div>
                `;
                return;
            }

            filteredTasks.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                return new Date(a.dueDate) - new Date(b.dueDate);
            });

            taskList.innerHTML = filteredTasks.map(task => {
                const dueDate = new Date(task.dueDate);
                const isOverdue = !task.completed && dueDate < today;
                
                return `
                    <div class="task-item priority-${task.priority} ${task.completed ? `completed` : ``}">
                        <input type="checkbox" class="checkbox" ${task.completed ? `checked` : ``} 
                               onchange="toggleTaskComplete(${task.id})">
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-meta">
                                <span><i class="fas fa-user"></i> ${task.assignee}</span>
                                <span><i class="fas fa-calendar"></i> ${formatDate(task.dueDate)}</span>
                                <span class="badge priority-${task.priority}">${task.priority}</span>
                                ${isOverdue ? `<span class="badge overdue">Overdue</span>` : ``}
                                ${task.recurring !== `none` ? `<span><i class="fas fa-repeat"></i> ${task.recurring}</span>` : ``}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="icon-btn" onclick="openTaskModal(${task.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn danger" onclick="deleteTask(${task.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join(``);
        }

        function toggleTaskComplete(taskId) {
            const task = data.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveData();
                renderTasks();
                renderDashboard();
                addActivity(`task`, task.completed ? `Completed task: ${task.title}` : `Reopened task: ${task.title}`);
                showToast(task.completed ? `Task completed!` : `Task reopened`, `success`);
            }
        }

        function deleteTask(taskId) {
            if (confirm(`Are you sure you want to delete this task?`)) {
                const task = data.tasks.find(t => t.id === taskId);
                data.tasks = data.tasks.filter(t => t.id !== taskId);
                saveData();
                renderTasks();
                renderDashboard();
                addActivity(`task`, `Deleted task: ${task.title}`);
                showToast(`Task deleted`, `success`);
            }
        }

        function filterTasks(filter) {
            currentFilter.tasks = filter;
            document.querySelectorAll(`#tasks .filter-btn`).forEach(btn => {
                btn.classList.remove(`active`);
            });
            event.target.classList.add(`active`);
            renderTasks();
        }

        function filterTasksByAssignee(assignee) {
            if (assignee === `all`) {
                renderTasks();
            } else {
                const taskList = document.getElementById(`taskList`);
                const filteredTasks = data.tasks.filter(task => task.assignee === assignee);
                
                if (filteredTasks.length === 0) {
                    taskList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tasks"></i>
                            <h3>No tasks found</h3>
                            <p>No tasks assigned to ${assignee}</p>
                        </div>
                    `;
                    return;
                }

                taskList.innerHTML = filteredTasks.map(task => {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const dueDate = new Date(task.dueDate);
                    const isOverdue = !task.completed && dueDate < today;
                    
                    return `
                        <div class="task-item priority-${task.priority} ${task.completed ? `completed` : ``}">
                            <input type="checkbox" class="checkbox" ${task.completed ? `checked` : ``} 
                                   onchange="toggleTaskComplete(${task.id})">
                            <div class="task-info">
                                <div class="task-title">${task.title}</div>
                                <div class="task-meta">
                                    <span><i class="fas fa-user"></i> ${task.assignee}</span>
                                    <span><i class="fas fa-calendar"></i> ${formatDate(task.dueDate)}</span>
                                    <span class="badge priority-${task.priority}">${task.priority}</span>
                                    ${isOverdue ? `<span class="badge overdue">Overdue</span>` : ``}
                                    ${task.recurring !== `none` ? `<span><i class="fas fa-repeat"></i> ${task.recurring}</span>` : ``}
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="icon-btn" onclick="openTaskModal(${task.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="icon-btn danger" onclick="deleteTask(${task.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join(``);
            }
        }

        function openMaintenanceModal(itemId = null) {
            const modal = document.getElementById(`maintenanceModal`);
            const form = document.getElementById(`maintenanceForm`);
            form.reset();
            
            if (itemId) {
                const item = data.maintenance.find(m => m.id === itemId);
                if (item) {
                    document.getElementById(`maintenanceId`).value = item.id;
                    document.getElementById(`maintenanceName`).value = item.name;
                    document.getElementById(`maintenanceCategory`).value = item.category;
                    document.getElementById(`maintenanceLastDate`).value = item.lastCompleted;
                    document.getElementById(`maintenanceFrequency`).value = item.frequency;
                    document.getElementById(`maintenanceCost`).value = item.cost;
                    document.getElementById(`maintenanceNotes`).value = item.notes;
                }
            } else {
                document.getElementById(`maintenanceId`).value = ``;
            }
            
            modal.classList.add(`active`);
        }

        function saveMaintenance(e) {
            e.preventDefault();
            
            const itemId = document.getElementById(`maintenanceId`).value;
            const item = {
                id: itemId ? parseInt(itemId) : Date.now(),
                name: document.getElementById(`maintenanceName`).value,
                category: document.getElementById(`maintenanceCategory`).value,
                lastCompleted: document.getElementById(`maintenanceLastDate`).value,
                frequency: document.getElementById(`maintenanceFrequency`).value,
                cost: parseFloat(document.getElementById(`maintenanceCost`).value) || 0,
                notes: document.getElementById(`maintenanceNotes`).value,
                createdAt: itemId ? data.maintenance.find(m => m.id === parseInt(itemId)).createdAt : Date.now()
            };

            if (itemId) {
                const index = data.maintenance.findIndex(m => m.id === parseInt(itemId));
                data.maintenance[index] = item;
                addActivity(`maintenance`, `Updated maintenance: ${item.name}`);
            } else {
                data.maintenance.push(item);
                addActivity(`maintenance`, `Added new maintenance item: ${item.name}`);
            }

            saveData();
            renderMaintenance();
            renderDashboard();
            closeModal(`maintenanceModal`);
            showToast(`Maintenance item saved!`, `success`);
        }

        function renderMaintenance() {
            const maintenanceList = document.getElementById(`maintenanceList`);
            let filteredItems = [...data.maintenance];

            if (currentFilter.maintenance !== `all`) {
                filteredItems = filteredItems.filter(item => item.category === currentFilter.maintenance);
            }

            if (filteredItems.length === 0) {
                maintenanceList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tools"></i>
                        <h3>No maintenance items found</h3>
                        <p>Add maintenance items to track</p>
                    </div>
                `;
                return;
            }

            maintenanceList.innerHTML = filteredItems.map(item => {
                const status = getMaintenanceStatus(item);
                
                return `
                    <div class="maintenance-item">
                        <div class="maintenance-info">
                            <div class="maintenance-title">${item.name}</div>
                            <div class="maintenance-meta">
                                <span><i class="fas fa-tag"></i> ${item.category}</span>
                                ${item.lastCompleted ? `<span><i class="fas fa-calendar"></i> Last: ${formatDate(item.lastCompleted)}</span>` : `<span>Never completed</span>`}
                                <span><i class="fas fa-redo"></i> Every ${item.frequency} months</span>
                                ${item.cost ? `<span><i class="fas fa-dollar-sign"></i> $${item.cost.toFixed(2)}</span>` : ``}
                                ${status.badge}
                            </div>
                        </div>
                        <div class="maintenance-actions">
                            <button class="icon-btn success" onclick="markMaintenanceComplete(${item.id})" title="Mark Complete">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="icon-btn" onclick="openMaintenanceModal(${item.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn danger" onclick="deleteMaintenance(${item.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join(``);
        }

        function getMaintenanceStatus(item) {
            if (!item.lastCompleted) {
                return { badge: `<span class="badge overdue">Never Done</span>`, isDue: true };
            }

            const lastDate = new Date(item.lastCompleted);
            const nextDue = new Date(lastDate);
            nextDue.setMonth(nextDue.getMonth() + parseInt(item.frequency));
            
            const today = new Date();
            const weekFromNow = new Date(today);
            weekFromNow.setDate(weekFromNow.getDate() + 7);

            if (nextDue <= today) {
                return { badge: `<span class="badge overdue">Overdue</span>`, isDue: true };
            } else if (nextDue <= weekFromNow) {
                return { badge: `<span class="badge due-soon">Due Soon</span>`, isDue: true };
            }
            
            return { badge: ``, isDue: false };
        }

        function markMaintenanceComplete(itemId) {
            const item = data.maintenance.find(m => m.id === itemId);
            if (item) {
                item.lastCompleted = new Date().toISOString().split(`T`)[0];
                saveData();
                renderMaintenance();
                renderDashboard();
                addActivity(`maintenance`, `Completed maintenance: ${item.name}`);
                showToast(`Maintenance marked as complete!`, `success`);
            }
        }

        function deleteMaintenance(itemId) {
            if (confirm(`Are you sure you want to delete this maintenance item?`)) {
                const item = data.maintenance.find(m => m.id === itemId);
                data.maintenance = data.maintenance.filter(m => m.id !== itemId);
                saveData();
                renderMaintenance();
                renderDashboard();
                addActivity(`maintenance`, `Deleted maintenance: ${item.name}`);
                showToast(`Maintenance item deleted`, `success`);
            }
        }

        function filterMaintenance(category) {
            currentFilter.maintenance = category;
            document.querySelectorAll(`#maintenance .filter-btn`).forEach(btn => {
                btn.classList.remove(`active`);
            });
            event.target.classList.add(`active`);
            renderMaintenance();
        }

        function openBillModal(billId = null) {
            const modal = document.getElementById(`billModal`);
            const form = document.getElementById(`billForm`);
            form.reset();
            
            if (billId) {
                const bill = data.bills.find(b => b.id === billId);
                if (bill) {
                    document.getElementById(`billId`).value = bill.id;
                    document.getElementById(`billName`).value = bill.name;
                    document.getElementById(`billAmount`).value = bill.amount;
                    document.getElementById(`billDueDate`).value = bill.dueDate;
                    document.getElementById(`billRecurring`).value = bill.recurring;
                    document.getElementById(`billFrequency`).value = bill.frequency;
                    document.getElementById(`billPaymentMethod`).value = bill.paymentMethod;
                    document.getElementById(`billNotes`).value = bill.notes;
                    toggleBillFrequency();
                }
            } else {
                document.getElementById(`billId`).value = ``;
                const today = new Date().toISOString().split(`T`)[0];
                document.getElementById(`billDueDate`).value = today;
            }
            
            modal.classList.add(`active`);
        }

        function toggleBillFrequency() {
            const recurring = document.getElementById(`billRecurring`).value;
            const frequencyGroup = document.getElementById(`billFrequencyGroup`);
            frequencyGroup.style.display = recurring === `yes` ? `block` : `none`;
        }

        function saveBill(e) {
            e.preventDefault();
            
            const billId = document.getElementById(`billId`).value;
            const bill = {
                id: billId ? parseInt(billId) : Date.now(),
                name: document.getElementById(`billName`).value,
                amount: parseFloat(document.getElementById(`billAmount`).value),
                dueDate: document.getElementById(`billDueDate`).value,
                recurring: document.getElementById(`billRecurring`).value,
                frequency: document.getElementById(`billFrequency`).value,
                paymentMethod: document.getElementById(`billPaymentMethod`).value,
                notes: document.getElementById(`billNotes`).value,
                paid: false,
                createdAt: billId ? data.bills.find(b => b.id === parseInt(billId)).createdAt : Date.now()
            };

            if (billId) {
                const index = data.bills.findIndex(b => b.id === parseInt(billId));
                data.bills[index] = bill;
                addActivity(`bill`, `Updated bill: ${bill.name}`);
            } else {
                data.bills.push(bill);
                addActivity(`bill`, `Added new bill: ${bill.name}`);
            }

            saveData();
            renderBills();
            renderDashboard();
            closeModal(`billModal`);
            showToast(`Bill saved successfully!`, `success`);
        }

        function renderBills() {
            const billList = document.getElementById(`billList`);
            let filteredBills = [...data.bills];

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            switch (currentFilter.bills) {
                case `upcoming`:
                    filteredBills = filteredBills.filter(bill => {
                        const dueDate = new Date(bill.dueDate);
                        return !bill.paid && dueDate >= today;
                    });
                    break;
                case `paid`:
                    filteredBills = filteredBills.filter(bill => bill.paid);
                    break;
                case `overdue`:
                    filteredBills = filteredBills.filter(bill => {
                        const dueDate = new Date(bill.dueDate);
                        return !bill.paid && dueDate < today;
                    });
                    break;
            }

            if (filteredBills.length === 0) {
                billList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <h3>No bills found</h3>
                        <p>Add bills to track payments</p>
                    </div>
                `;
            } else {
                filteredBills.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

                billList.innerHTML = filteredBills.map(bill => {
                    const dueDate = new Date(bill.dueDate);
                    const threeDaysFromNow = new Date(today);
                    threeDaysFromNow.setDate(threeDaysFromNow.getDate() + 3);
                    const isDueSoon = !bill.paid && dueDate <= threeDaysFromNow && dueDate >= today;
                    const isOverdue = !bill.paid && dueDate < today;
                    
                    return `
                        <div class="bill-item">
                            <div class="bill-info">
                                <div class="bill-title">${bill.name}</div>
                                <div class="bill-meta">
                                    <span><i class="fas fa-dollar-sign"></i> $${bill.amount.toFixed(2)}</span>
                                    <span><i class="fas fa-calendar"></i> Due: ${formatDate(bill.dueDate)}</span>
                                    ${bill.recurring === `yes` ? `<span><i class="fas fa-repeat"></i> ${bill.frequency}</span>` : ``}
                                    ${bill.paymentMethod ? `<span><i class="fas fa-credit-card"></i> ${bill.paymentMethod}</span>` : ``}
                                    ${bill.paid ? `<span class="badge paid">Paid</span>` : ``}
                                    ${isDueSoon ? `<span class="badge due-soon">Due Soon</span>` : ``}
                                    ${isOverdue ? `<span class="badge overdue">Overdue</span>` : ``}
                                </div>
                            </div>
                            <div class="bill-actions">
                                ${!bill.paid ? `
                                    <button class="icon-btn success" onclick="markBillPaid(${bill.id})" title="Mark Paid">
                                        <i class="fas fa-check"></i>
                                    </button>
                                ` : ``}
                                <button class="icon-btn" onclick="openBillModal(${bill.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="icon-btn danger" onclick="deleteBill(${bill.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join(``);
            }

            const monthlyTotal = data.bills
                .filter(bill => bill.recurring === `yes` && bill.frequency === `monthly`)
                .reduce((sum, bill) => sum + bill.amount, 0);
            
            document.getElementById(`monthlyTotal`).textContent = `$${monthlyTotal.toFixed(2)}`;
        }

        function markBillPaid(billId) {
            const bill = data.bills.find(b => b.id === billId);
            if (bill) {
                bill.paid = true;
                bill.paidDate = new Date().toISOString().split(`T`)[0];
                saveData();
                renderBills();
                renderDashboard();
                addActivity(`bill`, `Paid bill: ${bill.name} ($${bill.amount.toFixed(2)})`);
                showToast(`Bill marked as paid!`, `success`);
            }
        }

        function deleteBill(billId) {
            if (confirm(`Are you sure you want to delete this bill?`)) {
                const bill = data.bills.find(b => b.id === billId);
                data.bills = data.bills.filter(b => b.id !== billId);
                saveData();
                renderBills();
                renderDashboard();
                addActivity(`bill`, `Deleted bill: ${bill.name}`);
                showToast(`Bill deleted`, `success`);
            }
        }

        function filterBills(filter) {
            currentFilter.bills = filter;
            document.querySelectorAll(`#bills .filter-btn`).forEach(btn => {
                btn.classList.remove(`active`);
            });
            event.target.classList.add(`active`);
            renderBills();
        }

        function renderCalendar() {
            const monthYear = document.getElementById(`calendarMonth`);
            monthYear.textContent = currentMonth.toLocaleDateString(`en-US`, { month: `long`, year: `numeric` });

            const grid = document.getElementById(`calendarGrid`);
            const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
            const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
            const startingDayOfWeek = firstDay.getDay();
            const totalDays = lastDay.getDate();

            const days = [`Sun`, `Mon`, `Tue`, `Wed`, `Thu`, `Fri`, `Sat`];
            let html = days.map(day => `<div class="calendar-day-header">${day}</div>`).join(``);

            for (let i = 0; i < startingDayOfWeek; i++) {
                html += `<div class="calendar-day"></div>`;
            }

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let day = 1; day <= totalDays; day++) {
                const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
                date.setHours(0, 0, 0, 0);
                const isToday = date.getTime() === today.getTime();
                
                const eventsOnDay = data.events.filter(event => {
                    const eventDate = new Date(event.date);
                    eventDate.setHours(0, 0, 0, 0);
                    return eventDate.getTime() === date.getTime();
                });

                html += `
                    <div class="calendar-day ${isToday ? `today` : ``}">
                        <div>${day}</div>
                        ${eventsOnDay.map(() => `<div class="event-dot"></div>`).join(``)}
                    </div>
                `;
            }

            grid.innerHTML = html;

            renderEventList();
        }

        function renderEventList() {
            const eventList = document.getElementById(`eventList`);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const upcomingEvents = data.events
                .filter(event => new Date(event.date) >= today)
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            if (upcomingEvents.length === 0) {
                eventList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>No upcoming events</h3>
                        <p>Add events to your calendar</p>
                    </div>
                `;
                return;
            }

            eventList.innerHTML = upcomingEvents.map(event => `
                <div class="task-item">
                    <div class="task-info">
                        <div class="task-title">${event.name}</div>
                        <div class="task-meta">
                            <span><i class="fas fa-calendar"></i> ${formatDate(event.date)}</span>
                            ${event.time ? `<span><i class="fas fa-clock"></i> ${event.time}</span>` : ``}
                            ${event.location ? `<span><i class="fas fa-map-marker-alt"></i> ${event.location}</span>` : ``}
                            ${event.members.length > 0 ? `<span><i class="fas fa-users"></i> ${event.members.join(`, `)}</span>` : ``}
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="icon-btn" onclick="openEventModal(${event.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="icon-btn danger" onclick="deleteEvent(${event.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join(``);
        }

        function previousMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        }

        function openEventModal(eventId = null) {
            const modal = document.getElementById(`eventModal`);
            const form = document.getElementById(`eventForm`);
            form.reset();
            
            if (eventId) {
                const event = data.events.find(e => e.id === eventId);
                if (event) {
                    document.getElementById(`eventId`).value = event.id;
                    document.getElementById(`eventName`).value = event.name;
                    document.getElementById(`eventDate`).value = event.date;
                    document.getElementById(`eventTime`).value = event.time;
                    document.getElementById(`eventLocation`).value = event.location;
                    document.getElementById(`eventNotes`).value = event.notes;
                    
                    const select = document.getElementById(`eventMembers`);
                    Array.from(select.options).forEach(option => {
                        option.selected = event.members.includes(option.value);
                    });
                }
            } else {
                document.getElementById(`eventId`).value = ``;
                const today = new Date().toISOString().split(`T`)[0];
                document.getElementById(`eventDate`).value = today;
            }
            
            modal.classList.add(`active`);
        }

        async function saveEvent(e) {
            e.preventDefault();
            
            const eventId = document.getElementById(`eventId`).value;
            const select = document.getElementById(`eventMembers`);
            const selectedMembers = Array.from(select.selectedOptions).map(option => option.value);
            
            const event = {
                id: eventId ? parseInt(eventId) : Date.now(),
                name: document.getElementById(`eventName`).value,
                date: document.getElementById(`eventDate`).value,
                time: document.getElementById(`eventTime`).value,
                members: selectedMembers,
                location: document.getElementById(`eventLocation`).value,
                notes: document.getElementById(`eventNotes`).value,
                createdAt: eventId ? data.events.find(ev => ev.id === parseInt(eventId)).createdAt : Date.now()
            };

            if (eventId) {
                const index = data.events.findIndex(ev => ev.id === parseInt(eventId));
                const oldEvent = data.events[index];
                event.gcalId = oldEvent.gcalId; // Preserve Google Calendar ID
                data.events[index] = event;
                addActivity(`event`, `Updated event: ${event.name}`);
                
                // Update in Google Calendar if connected
                if (accessToken && event.gcalId) {
                    await updateGoogleCalendarEvent(event);
                }
            } else {
                data.events.push(event);
                addActivity(`event`, `Added new event: ${event.name}`);
                
                // Create in Google Calendar if connected
                if (accessToken) {
                    const gcalEvent = await createGoogleCalendarEvent(event);
                    if (gcalEvent) {
                        event.gcalId = gcalEvent.id;
                    }
                }
            }

            saveData();
            renderCalendar();
            renderDashboard();
            closeModal(`eventModal`);
            showToast(`Event saved successfully!`, `success`);
        }

        async function deleteEvent(eventId) {
            if (confirm(`Are you sure you want to delete this event?`)) {
                const event = data.events.find(e => e.id === eventId);
                
                // Delete from Google Calendar if connected
                if (accessToken && event.gcalId) {
                    await deleteGoogleCalendarEvent(event.gcalId);
                }
                
                data.events = data.events.filter(e => e.id !== eventId);
                saveData();
                renderCalendar();
                renderDashboard();
                addActivity(`event`, `Deleted event: ${event.name}`);
                showToast(`Event deleted`, `success`);
            }
        }

        function openShoppingModal(category) {
            const modal = document.getElementById(`shoppingModal`);
            const form = document.getElementById(`shoppingForm`);
            form.reset();
            document.getElementById(`shoppingCategory`).value = category;
            modal.classList.add(`active`);
        }

        function saveShoppingItem(e) {
            e.preventDefault();
            
            const category = document.getElementById(`shoppingCategory`).value;
            const item = {
                id: Date.now(),
                name: document.getElementById(`shoppingItemName`).value,
                quantity: document.getElementById(`shoppingQuantity`).value,
                priority: document.getElementById(`shoppingPriority`).value,
                completed: false
            };

            data.shoppingLists[category].push(item);
            saveData();
            renderShoppingLists();
            closeModal(`shoppingModal`);
            addActivity(`shopping`, `Added to ${category} list: ${item.name}`);
            showToast(`Item added to shopping list!`, `success`);
        }

        function renderShoppingLists() {
            Object.keys(data.shoppingLists).forEach(category => {
                const listElement = document.getElementById(`${category}List`);
                const items = data.shoppingLists[category];

                if (items.length === 0) {
                    listElement.innerHTML = `<p style="color: var(--text-light); text-align: center; padding: 20px;">No items</p>`;
                    return;
                }

                listElement.innerHTML = items.map(item => `
                    <div class="shopping-item ${item.completed ? `completed` : ``}">
                        <input type="checkbox" class="checkbox" ${item.completed ? `checked` : ``}
                               onchange="toggleShoppingItem('${category}', ${item.id})">
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">${item.name}</div>
                            ${item.quantity ? `<div style="font-size: 12px; color: var(--text-light);">${item.quantity}</div>` : ``}
                        </div>
                        <button class="icon-btn danger" onclick="deleteShoppingItem('${category}', ${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join(``);
            });
        }

        function toggleShoppingItem(category, itemId) {
            const item = data.shoppingLists[category].find(i => i.id === itemId);
            if (item) {
                item.completed = !item.completed;
                saveData();
                renderShoppingLists();
            }
        }

        function deleteShoppingItem(category, itemId) {
            data.shoppingLists[category] = data.shoppingLists[category].filter(i => i.id !== itemId);
            saveData();
            renderShoppingLists();
        }

        function clearCompleted(category) {
            const completedCount = data.shoppingLists[category].filter(i => i.completed).length;
            if (completedCount === 0) {
                showToast(`No completed items to clear`, `info`);
                return;
            }

            if (confirm(`Clear ${completedCount} completed item(s)?`)) {
                data.shoppingLists[category] = data.shoppingLists[category].filter(i => !i.completed);
                saveData();
                renderShoppingLists();
                showToast(`Completed items cleared`, `success`);
            }
        }

        function openContactModal(contactId = null) {
            const modal = document.getElementById(`contactModal`);
            const form = document.getElementById(`contactForm`);
            form.reset();
            
            if (contactId) {
                const contact = data.contacts.find(c => c.id === contactId);
                if (contact) {
                    document.getElementById(`contactId`).value = contact.id;
                    document.getElementById(`contactName`).value = contact.name;
                    document.getElementById(`contactCategory`).value = contact.category;
                    document.getElementById(`contactPhone`).value = contact.phone;
                    document.getElementById(`contactEmail`).value = contact.email;
                    document.getElementById(`contactNotes`).value = contact.notes;
                }
            } else {
                document.getElementById(`contactId`).value = ``;
            }
            
            modal.classList.add(`active`);
        }

        function saveContact(e) {
            e.preventDefault();
            
            const contactId = document.getElementById(`contactId`).value;
            const contact = {
                id: contactId ? parseInt(contactId) : Date.now(),
                name: document.getElementById(`contactName`).value,
                category: document.getElementById(`contactCategory`).value,
                phone: document.getElementById(`contactPhone`).value,
                email: document.getElementById(`contactEmail`).value,
                notes: document.getElementById(`contactNotes`).value,
                createdAt: contactId ? data.contacts.find(c => c.id === parseInt(contactId)).createdAt : Date.now()
            };

            if (contactId) {
                const index = data.contacts.findIndex(c => c.id === parseInt(contactId));
                data.contacts[index] = contact;
                addActivity(`contact`, `Updated contact: ${contact.name}`);
            } else {
                data.contacts.push(contact);
                addActivity(`contact`, `Added new contact: ${contact.name}`);
            }

            saveData();
            renderContacts();
            closeModal(`contactModal`);
            showToast(`Contact saved successfully!`, `success`);
        }

        function renderContacts() {
            const contactList = document.getElementById(`contactList`);
            let filteredContacts = [...data.contacts];

            if (currentFilter.contacts !== `all`) {
                filteredContacts = filteredContacts.filter(contact => contact.category === currentFilter.contacts);
            }

            if (filteredContacts.length === 0) {
                contactList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-address-book"></i>
                        <h3>No contacts found</h3>
                        <p>Add important contacts</p>
                    </div>
                `;
                return;
            }

            filteredContacts.sort((a, b) => a.name.localeCompare(b.name));

            contactList.innerHTML = filteredContacts.map(contact => `
                <div class="contact-item">
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-meta">
                            <span><i class="fas fa-tag"></i> ${contact.category}</span>
                            ${contact.phone ? `<span><i class="fas fa-phone"></i> <a href="tel:${contact.phone}" style="color: inherit; text-decoration: none;">${contact.phone}</a></span>` : ``}
                            ${contact.email ? `<span><i class="fas fa-envelope"></i> <a href="mailto:${contact.email}" style="color: inherit; text-decoration: none;">${contact.email}</a></span>` : ``}
                        </div>
                    </div>
                    <div class="contact-actions">
                        <button class="icon-btn" onclick="openContactModal(${contact.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="icon-btn danger" onclick="deleteContact(${contact.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join(``);
        }

        function deleteContact(contactId) {
            if (confirm(`Are you sure you want to delete this contact?`)) {
                const contact = data.contacts.find(c => c.id === contactId);
                data.contacts = data.contacts.filter(c => c.id !== contactId);
                saveData();
                renderContacts();
                addActivity(`contact`, `Deleted contact: ${contact.name}`);
                showToast(`Contact deleted`, `success`);
            }
        }

        function filterContacts(category) {
            currentFilter.contacts = category;
            document.querySelectorAll(`#contacts .filter-btn`).forEach(btn => {
                btn.classList.remove(`active`);
            });
            event.target.classList.add(`active`);
            renderContacts();
        }

        function openExpenseModal(expenseId = null) {
            const modal = document.getElementById(`expenseModal`);
            const form = document.getElementById(`expenseForm`);
            form.reset();
            
            if (expenseId) {
                const expense = data.expenses.find(e => e.id === expenseId);
                if (expense) {
                    document.getElementById(`expenseId`).value = expense.id;
                    document.getElementById(`expenseDescription`).value = expense.description;
                    document.getElementById(`expenseAmount`).value = expense.amount;
                    document.getElementById(`expenseDate`).value = expense.date;
                    document.getElementById(`expenseCategory`).value = expense.category;
                }
            } else {
                document.getElementById(`expenseId`).value = ``;
                const today = new Date().toISOString().split(`T`)[0];
                document.getElementById(`expenseDate`).value = today;
            }
            
            modal.classList.add(`active`);
        }

        function saveExpense(e) {
            e.preventDefault();
            
            const expenseId = document.getElementById(`expenseId`).value;
            const expense = {
                id: expenseId ? parseInt(expenseId) : Date.now(),
                description: document.getElementById(`expenseDescription`).value,
                amount: parseFloat(document.getElementById(`expenseAmount`).value),
                date: document.getElementById(`expenseDate`).value,
                category: document.getElementById(`expenseCategory`).value,
                createdAt: expenseId ? data.expenses.find(ex => ex.id === parseInt(expenseId)).createdAt : Date.now()
            };

            if (expenseId) {
                const index = data.expenses.findIndex(ex => ex.id === parseInt(expenseId));
                data.expenses[index] = expense;
                addActivity(`expense`, `Updated expense: ${expense.description}`);
            } else {
                data.expenses.push(expense);
                addActivity(`expense`, `Added expense: ${expense.description} ($${expense.amount.toFixed(2)})`);
            }

            saveData();
            renderBudget();
            closeModal(`expenseModal`);
            showToast(`Expense saved successfully!`, `success`);
        }

        function renderBudget() {
            const income = parseFloat(document.getElementById(`monthlyIncome`).value) || data.monthlyIncome || 0;
            data.monthlyIncome = income;
            saveData();

            const categoryTotals = {};
            data.expenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });

            const totalExpenses = Object.values(categoryTotals).reduce((sum, val) => sum + val, 0);
            const remaining = income - totalExpenses;

            document.getElementById(`totalIncome`).textContent = `$${income.toFixed(2)}`;
            document.getElementById(`totalExpenses`).textContent = `$${totalExpenses.toFixed(2)}`;
            document.getElementById(`remainingBudget`).textContent = `$${remaining.toFixed(2)}`;

            const ctx = document.getElementById(`budgetChart`).getContext(`2d`);
            
            if (budgetChart) {
                budgetChart.destroy();
            }

            const categories = Object.keys(categoryTotals);
            const amounts = Object.values(categoryTotals);
            const colors = [
                `#475569`,
                `#f97316`,
                `#10b981`,
                `#f59e0b`,
                `#ef4444`,
                `#8b5cf6`,
                `#06b6d4`,
                `#ec4899`
            ];

            budgetChart = new Chart(ctx, {
                type: `doughnut`,
                data: {
                    labels: categories.map(cat => cat.charAt(0).toUpperCase() + cat.slice(1)),
                    datasets: [{
                        data: amounts,
                        backgroundColor: colors.slice(0, categories.length),
                        borderWidth: 2,
                        borderColor: `#ffffff`
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: `bottom`,
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || ``;
                                    const value = context.parsed || 0;
                                    const percentage = ((value / totalExpenses) * 100).toFixed(1);
                                    return `${label}: $${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            const tableBody = document.getElementById(`expenseTableBody`);
            const recentExpenses = [...data.expenses]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);

            if (recentExpenses.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: var(--text-light);">
                            No expenses recorded
                        </td>
                    </tr>
                `;
            } else {
                tableBody.innerHTML = recentExpenses.map(expense => `
                    <tr>
                        <td>${formatDate(expense.date)}</td>
                        <td>${expense.description}</td>
                        <td>${expense.category.charAt(0).toUpperCase() + expense.category.slice(1)}</td>
                        <td>$${expense.amount.toFixed(2)}</td>
                        <td>
                            <button class="icon-btn" onclick="openExpenseModal(${expense.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn danger" onclick="deleteExpense(${expense.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join(``);
            }
        }

        function updateBudgetSummary() {
            renderBudget();
        }

        function deleteExpense(expenseId) {
            if (confirm(`Are you sure you want to delete this expense?`)) {
                const expense = data.expenses.find(e => e.id === expenseId);
                data.expenses = data.expenses.filter(e => e.id !== expenseId);
                saveData();
                renderBudget();
                addActivity(`expense`, `Deleted expense: ${expense.description}`);
                showToast(`Expense deleted`, `success`);
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove(`active`);
        }

        function showToast(message, type = `info`) {
            const toast = document.createElement(`div`);
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === `success` ? `check-circle` : type === `error` ? `exclamation-circle` : type === `warning` ? `exclamation-triangle` : `info-circle`}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = `slideInRight 0.3s reverse`;
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString(`en-US`, { month: `short`, day: `numeric`, year: `numeric` });
        }

        function toggleDarkMode() {
            document.body.classList.toggle(`dark-mode`);
            const icon = document.querySelector(`.dark-mode-toggle i`);
            icon.className = document.body.classList.contains(`dark-mode`) ? `fas fa-sun` : `fas fa-moon`;
            localStorage.setItem(`darkMode`, document.body.classList.contains(`dark-mode`));
        }

        function exportData() {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: `application/json` });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement(`a`);
            link.href = url;
            link.download = `family-business-backup-${new Date().toISOString().split(`T`)[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showToast(`Data exported successfully!`, `success`);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (confirm(`This will replace all current data. Are you sure?`)) {
                            data = importedData;
                            saveData();
                            location.reload();
                        }
                    } catch (error) {
                        showToast(`Error importing data. Please check the file format.`, `error`);
                    }
                };
                reader.readAsText(file);
            }
        }

        let inboxFiles = [];

        function handleInboxFile(event, type) {
            const files = event.target.files;
            if (files.length > 0) {
                Array.from(files).forEach(file => {
                    inboxFiles.push({ file, type });
                });
                renderInboxFiles();
                
                if (type === 'document') {
                    readDocumentFile(files[0]);
                }
            }
        }

        function renderInboxFiles() {
            const container = document.getElementById('inboxSelectedFiles');
            container.innerHTML = inboxFiles.map((item, index) => `
                <div class="inbox-file-tag">
                    <i class="fas fa-${item.type === 'voice' ? 'microphone' : 'file-alt'}"></i>
                    <span>${item.file.name}</span>
                    <button onclick="removeInboxFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function removeInboxFile(index) {
            inboxFiles.splice(index, 1);
            renderInboxFiles();
        }

        function readDocumentFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const textarea = document.getElementById('inboxTextarea');
                if (textarea.value) {
                    textarea.value += '\n\n' + content;
                } else {
                    textarea.value = content;
                }
                showToast('Document content loaded into inbox', 'success');
            };
            reader.readAsText(file);
        }

        function clearInbox() {
            document.getElementById('inboxTextarea').value = '';
            inboxFiles = [];
            renderInboxFiles();
            document.getElementById('inboxResults').classList.remove('active');
            showToast('Inbox cleared', 'info');
        }

        async function processInbox() {
            const textarea = document.getElementById('inboxTextarea');
            const text = textarea.value.trim();
            
            if (!text && inboxFiles.length === 0) {
                showToast('Please enter some text or upload a file', 'warning');
                return;
            }

            const processing = document.getElementById('inboxProcessing');
            const results = document.getElementById('inboxResults');
            
            processing.classList.add('active');
            results.classList.remove('active');

            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const parsedItems = parseInboxContent(text);
                
                let itemsAdded = 0;
                const resultsSummary = {
                    tasks: [],
                    maintenance: [],
                    bills: [],
                    events: [],
                    shopping: [],
                    contacts: [],
                    expenses: []
                };

                parsedItems.forEach(item => {
                    switch(item.type) {
                        case 'task':
                            const task = createTaskFromParsed(item);
                            data.tasks.push(task);
                            resultsSummary.tasks.push(task);
                            addActivity('task', `Added task from inbox: ${task.title}`);
                            itemsAdded++;
                            break;
                        case 'bill':
                            const bill = createBillFromParsed(item);
                            data.bills.push(bill);
                            resultsSummary.bills.push(bill);
                            addActivity('bill', `Added bill from inbox: ${bill.name}`);
                            itemsAdded++;
                            break;
                        case 'maintenance':
                            const maintenance = createMaintenanceFromParsed(item);
                            data.maintenance.push(maintenance);
                            resultsSummary.maintenance.push(maintenance);
                            addActivity('maintenance', `Added maintenance from inbox: ${maintenance.name}`);
                            itemsAdded++;
                            break;
                        case 'event':
                            const event = createEventFromParsed(item);
                            data.events.push(event);
                            resultsSummary.events.push(event);
                            addActivity('event', `Added event from inbox: ${event.name}`);
                            itemsAdded++;
                            break;
                        case 'shopping':
                            item.items.forEach(shoppingItem => {
                                const category = determineShoppingCategory(shoppingItem);
                                const newItem = {
                                    id: Date.now() + Math.random(),
                                    name: shoppingItem,
                                    quantity: '',
                                    priority: 'medium',
                                    completed: false
                                };
                                data.shoppingLists[category].push(newItem);
                                resultsSummary.shopping.push({ item: shoppingItem, category });
                                itemsAdded++;
                            });
                            addActivity('shopping', `Added ${item.items.length} items from inbox`);
                            break;
                        case 'contact':
                            const contact = createContactFromParsed(item);
                            data.contacts.push(contact);
                            resultsSummary.contacts.push(contact);
                            addActivity('contact', `Added contact from inbox: ${contact.name}`);
                            itemsAdded++;
                            break;
                        case 'expense':
                            const expense = createExpenseFromParsed(item);
                            data.expenses.push(expense);
                            resultsSummary.expenses.push(expense);
                            addActivity('expense', `Added expense from inbox: ${expense.description}`);
                            itemsAdded++;
                            break;
                    }
                });

                saveData();
                renderDashboard();
                renderTasks();
                renderMaintenance();
                renderBills();
                renderCalendar();
                renderShoppingLists();
                renderContacts();
                renderBudget();

                displayInboxResults(resultsSummary);
                
                processing.classList.remove('active');
                
                showToast(`Successfully processed ${itemsAdded} items!`, 'success');
                
                setTimeout(() => {
                    textarea.value = '';
                    inboxFiles = [];
                    renderInboxFiles();
                }, 2000);

            } catch (error) {
                processing.classList.remove('active');
                showToast('Error processing inbox. Please try again.', 'error');
                console.error(error);
            }
        }

        function parseInboxContent(text) {
            const items = [];
            const lines = text.split('\n').filter(line => line.trim());

            lines.forEach(line => {
                line = line.trim();
                
                if (isTask(line)) {
                    items.push(parseTask(line));
                } else if (isBill(line)) {
                    items.push(parseBill(line));
                } else if (isMaintenance(line)) {
                    items.push(parseMaintenance(line));
                } else if (isEvent(line)) {
                    items.push(parseEvent(line));
                } else if (isShoppingList(line)) {
                    items.push(parseShoppingList(line));
                } else if (isContact(line)) {
                    items.push(parseContact(line));
                } else if (isExpense(line)) {
                    items.push(parseExpense(line));
                }
            });

            return items;
        }

        function isTask(line) {
            const taskKeywords = ['remind', 'task', 'todo', 'need to', 'don\'t forget', 'remember to', 'should', 'must'];
            const lowerLine = line.toLowerCase();
            return taskKeywords.some(keyword => lowerLine.includes(keyword));
        }

        function isBill(line) {
            const billKeywords = ['bill', 'payment', 'due', 'pay', 'invoice', 'subscription'];
            const lowerLine = line.toLowerCase();
            const hasMoney = /\$\d+/.test(line);
            return (billKeywords.some(keyword => lowerLine.includes(keyword)) || hasMoney) && 
                   (lowerLine.includes('due') || lowerLine.includes('pay'));
        }

        function isMaintenance(line) {
            const maintenanceKeywords = ['maintenance', 'service', 'repair', 'fix', 'change', 'replace', 'oil change', 'filter', 'inspection', 'tune-up', 'hvac', 'check'];
            const lowerLine = line.toLowerCase();
            return maintenanceKeywords.some(keyword => lowerLine.includes(keyword));
        }

        function isEvent(line) {
            const eventKeywords = ['meeting', 'appointment', 'conference', 'party', 'birthday', 'anniversary', 'dinner', 'lunch'];
            const lowerLine = line.toLowerCase();
            const hasTime = /\d{1,2}:\d{2}|\d{1,2}\s?(am|pm)/i.test(line);
            const hasDayOfWeek = /(monday|tuesday|wednesday|thursday|friday|saturday|sunday|next|this)/i.test(line);
            return eventKeywords.some(keyword => lowerLine.includes(keyword)) || (hasTime && hasDayOfWeek);
        }

        function isShoppingList(line) {
            const shoppingKeywords = ['buy', 'get', 'pick up', 'purchase', 'shopping', 'grocery', 'groceries', 'store'];
            const lowerLine = line.toLowerCase();
            return shoppingKeywords.some(keyword => lowerLine.includes(keyword));
        }

        function isContact(line) {
            const contactKeywords = ['contact', 'phone', 'email', 'call', 'reach'];
            const lowerLine = line.toLowerCase();
            const hasPhone = /\d{3}[-.]?\d{3}[-.]?\d{4}/.test(line);
            const hasEmail = /\S+@\S+\.\S+/.test(line);
            return (contactKeywords.some(keyword => lowerLine.includes(keyword)) || hasPhone || hasEmail);
        }

        function isExpense(line) {
            const expenseKeywords = ['spent', 'paid', 'bought', 'purchased', 'cost'];
            const lowerLine = line.toLowerCase();
            const hasMoney = /\$\d+/.test(line);
            return expenseKeywords.some(keyword => lowerLine.includes(keyword)) && hasMoney;
        }

        function parseTask(line) {
            const assigneeMatch = data.familyMembers.find(member => 
                line.toLowerCase().includes(member.toLowerCase())
            );
            
            const dateMatch = extractDate(line);
            const priorityMatch = extractPriority(line);
            
            let title = line
                .replace(/remind|task|todo|need to|don't forget|remember to|should|must/gi, '')
                .replace(new RegExp(assigneeMatch || '', 'gi'), '')
                .trim();
            
            title = title.charAt(0).toUpperCase() + title.slice(1);
            
            return {
                type: 'task',
                title: title || line,
                assignee: assigneeMatch || data.familyMembers[0],
                dueDate: dateMatch,
                priority: priorityMatch,
                description: line
            };
        }

        function parseBill(line) {
            const amountMatch = line.match(/\$(\d+(?:\.\d{2})?)/);
            const amount = amountMatch ? parseFloat(amountMatch[1]) : 0;
            
            const dateMatch = extractDate(line);
            
            let name = line
                .replace(/\$\d+(?:\.\d{2})?/, '')
                .replace(/bill|payment|due|pay|invoice/gi, '')
                .trim();
            
            name = name.charAt(0).toUpperCase() + name.slice(1);
            
            return {
                type: 'bill',
                name: name || 'Bill Payment',
                amount: amount,
                dueDate: dateMatch
            };
        }

        function parseMaintenance(line) {
            const categoryMatch = line.toLowerCase().includes('car') || line.toLowerCase().includes('vehicle') ? 'vehicle' :
                                 line.toLowerCase().includes('yard') || line.toLowerCase().includes('lawn') ? 'yard' :
                                 line.toLowerCase().includes('appliance') ? 'appliances' : 'home';
            
            const dateMatch = extractDate(line);
            
            let name = line
                .replace(/maintenance|service|repair|fix|change|replace|check/gi, '')
                .trim();
            
            name = name.charAt(0).toUpperCase() + name.slice(1);
            
            return {
                type: 'maintenance',
                name: name || line,
                category: categoryMatch,
                dueDate: dateMatch
            };
        }

        function parseEvent(line) {
            const dateMatch = extractDate(line);
            const timeMatch = line.match(/\d{1,2}:\d{2}|\d{1,2}\s?(am|pm)/i);
            const time = timeMatch ? timeMatch[0] : '';
            
            const membersMatched = data.familyMembers.filter(member => 
                line.toLowerCase().includes(member.toLowerCase())
            );
            
            let name = line
                .replace(/meeting|appointment|conference/gi, '')
                .replace(new RegExp(membersMatched.join('|'), 'gi'), '')
                .replace(timeMatch ? timeMatch[0] : '', '')
                .trim();
            
            name = name.charAt(0).toUpperCase() + name.slice(1);
            
            return {
                type: 'event',
                name: name || line,
                date: dateMatch,
                time: time,
                members: membersMatched.length > 0 ? membersMatched : []
            };
        }

        function parseShoppingList(line) {
            let items = line
                .replace(/buy|get|pick up|purchase|shopping|grocery|groceries|store/gi, '')
                .split(/,|and|\n/)
                .map(item => item.trim())
                .filter(item => item.length > 0);
            
            items = items.map(item => item.charAt(0).toUpperCase() + item.slice(1));
            
            return {
                type: 'shopping',
                items: items
            };
        }

        function parseContact(line) {
            const phoneMatch = line.match(/\d{3}[-.]?\d{3}[-.]?\d{4}/);
            const emailMatch = line.match(/\S+@\S+\.\S+/);
            
            let name = line
                .replace(/contact|phone|email|call|reach/gi, '')
                .replace(phoneMatch ? phoneMatch[0] : '', '')
                .replace(emailMatch ? emailMatch[0] : '', '')
                .trim();
            
            name = name.charAt(0).toUpperCase() + name.slice(1);
            
            return {
                type: 'contact',
                name: name || 'New Contact',
                phone: phoneMatch ? phoneMatch[0] : '',
                email: emailMatch ? emailMatch[0] : ''
            };
        }

        function parseExpense(line) {
            const amountMatch = line.match(/\$(\d+(?:\.\d{2})?)/);
            const amount = amountMatch ? parseFloat(amountMatch[1]) : 0;
            
            let description = line
                .replace(/\$\d+(?:\.\d{2})?/, '')
                .replace(/spent|paid|bought|purchased|cost/gi, '')
                .trim();
            
            description = description.charAt(0).toUpperCase() + description.slice(1);
            
            return {
                type: 'expense',
                description: description || 'Expense',
                amount: amount
            };
        }

        function extractDate(line) {
            const today = new Date();
            const lowerLine = line.toLowerCase();
            
            if (lowerLine.includes('today')) {
                return today.toISOString().split('T')[0];
            }
            
            if (lowerLine.includes('tomorrow')) {
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                return tomorrow.toISOString().split('T')[0];
            }
            
            const daysOfWeek = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            for (let i = 0; i < daysOfWeek.length; i++) {
                if (lowerLine.includes(daysOfWeek[i])) {
                    const targetDay = i;
                    const currentDay = today.getDay();
                    let daysUntil = targetDay - currentDay;
                    if (daysUntil <= 0) daysUntil += 7;
                    const targetDate = new Date(today);
                    targetDate.setDate(targetDate.getDate() + daysUntil);
                    return targetDate.toISOString().split('T')[0];
                }
            }
            
            if (lowerLine.includes('next week')) {
                const nextWeek = new Date(today);
                nextWeek.setDate(nextWeek.getDate() + 7);
                return nextWeek.toISOString().split('T')[0];
            }
            
            if (lowerLine.includes('next month')) {
                const nextMonth = new Date(today);
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                return nextMonth.toISOString().split('T')[0];
            }
            
            const dateMatch = line.match(/(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?/);
            if (dateMatch) {
                const month = parseInt(dateMatch[1]) - 1;
                const day = parseInt(dateMatch[2]);
                const year = dateMatch[3] ? parseInt(dateMatch[3]) : today.getFullYear();
                return new Date(year, month, day).toISOString().split('T')[0];
            }
            
            const numberMatch = line.match(/in (\d+) (day|week|month)s?/i);
            if (numberMatch) {
                const amount = parseInt(numberMatch[1]);
                const unit = numberMatch[2].toLowerCase();
                const futureDate = new Date(today);
                
                if (unit === 'day') {
                    futureDate.setDate(futureDate.getDate() + amount);
                } else if (unit === 'week') {
                    futureDate.setDate(futureDate.getDate() + (amount * 7));
                } else if (unit === 'month') {
                    futureDate.setMonth(futureDate.getMonth() + amount);
                }
                
                return futureDate.toISOString().split('T')[0];
            }
            
            const weekFromNow = new Date(today);
            weekFromNow.setDate(weekFromNow.getDate() + 7);
            return weekFromNow.toISOString().split('T')[0];
        }

        function extractPriority(line) {
            const lowerLine = line.toLowerCase();
            if (lowerLine.includes('urgent') || lowerLine.includes('asap') || lowerLine.includes('important')) {
                return 'high';
            }
            if (lowerLine.includes('low priority') || lowerLine.includes('whenever')) {
                return 'low';
            }
            return 'medium';
        }

        function determineShoppingCategory(item) {
            const groceryItems = ['milk', 'bread', 'eggs', 'cheese', 'butter', 'meat', 'chicken', 'beef', 'fish', 'vegetables', 'fruits', 'apple', 'banana', 'orange'];
            const hardwareItems = ['screws', 'nails', 'hammer', 'drill', 'paint', 'brush', 'tools'];
            const pharmacyItems = ['medicine', 'pills', 'prescription', 'vitamins', 'bandages', 'aspirin'];
            
            const lowerItem = item.toLowerCase();
            
            if (groceryItems.some(g => lowerItem.includes(g))) return 'groceries';
            if (hardwareItems.some(h => lowerItem.includes(h))) return 'hardware';
            if (pharmacyItems.some(p => lowerItem.includes(p))) return 'pharmacy';
            
            return 'other';
        }

        function createTaskFromParsed(item) {
            return {
                id: Date.now(),
                title: item.title,
                description: item.description || '',
                assignee: item.assignee,
                dueDate: item.dueDate,
                priority: item.priority,
                recurring: 'none',
                completed: false,
                createdAt: Date.now()
            };
        }

        function createBillFromParsed(item) {
            return {
                id: Date.now(),
                name: item.name,
                amount: item.amount,
                dueDate: item.dueDate,
                recurring: 'no',
                frequency: 'monthly',
                paymentMethod: '',
                notes: '',
                paid: false,
                createdAt: Date.now()
            };
        }

        function createMaintenanceFromParsed(item) {
            return {
                id: Date.now(),
                name: item.name,
                category: item.category,
                lastCompleted: '',
                frequency: 3,
                cost: 0,
                notes: '',
                createdAt: Date.now()
            };
        }

        function createEventFromParsed(item) {
            return {
                id: Date.now(),
                name: item.name,
                date: item.date,
                time: item.time,
                members: item.members,
                location: '',
                notes: '',
                createdAt: Date.now()
            };
        }

        function createContactFromParsed(item) {
            return {
                id: Date.now(),
                name: item.name,
                category: 'other',
                phone: item.phone,
                email: item.email,
                notes: '',
                createdAt: Date.now()
            };
        }

        function createExpenseFromParsed(item) {
            return {
                id: Date.now(),
                description: item.description,
                amount: item.amount,
                date: new Date().toISOString().split('T')[0],
                category: 'other',
                createdAt: Date.now()
            };
        }

        function displayInboxResults(summary) {
            const results = document.getElementById('inboxResults');
            let html = '<h3 style="margin-bottom: 16px; color: var(--primary);"><i class="fas fa-check-circle"></i> Items Added</h3>';
            
            if (summary.tasks.length > 0) {
                html += '<div class="inbox-result-section">';
                html += '<h4><i class="fas fa-tasks"></i> Tasks (' + summary.tasks.length + ')</h4>';
                summary.tasks.forEach(task => {
                    html += `<div class="inbox-result-item">
                        <div class="inbox-result-item-content">
                            <strong>${task.title}</strong><br>
                            <small>Assigned to ${task.assignee} • Due ${formatDate(task.dueDate)}</small>
                        </div>
                        <span class="inbox-result-badge task">Task</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            if (summary.bills.length > 0) {
                html += '<div class="inbox-result-section">';
                html += '<h4><i class="fas fa-file-invoice-dollar"></i> Bills (' + summary.bills.length + ')</h4>';
                summary.bills.forEach(bill => {
                    html += `<div class="inbox-result-item">
                        <div class="inbox-result-item-content">
                            <strong>${bill.name}</strong><br>
                            <small>$${bill.amount.toFixed(2)} • Due ${formatDate(bill.dueDate)}</small>
                        </div>
                        <span class="inbox-result-badge bill">Bill</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            if (summary.maintenance.length > 0) {
                html += '<div class="inbox-result-section">';
                html += '<h4><i class="fas fa-tools"></i> Maintenance (' + summary.maintenance.length + ')</h4>';
                summary.maintenance.forEach(item => {
                    html += `<div class="inbox-result-item">
                        <div class="inbox-result-item-content">
                            <strong>${item.name}</strong><br>
                            <small>${item.category}</small>
                        </div>
                        <span class="inbox-result-badge maintenance">Maintenance</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            if (summary.events.length > 0) {
                html += '<div class="inbox-result-section">';
                html += '<h4><i class="fas fa-calendar-alt"></i> Events (' + summary.events.length + ')</h4>';
                summary.events.forEach(event => {
                    html += `<div class="inbox-result-item">
                        <div class="inbox-result-item-content">
                            <strong>${event.name}</strong><br>
                            <small>${formatDate(event.date)}${event.time ? ' at ' + event.time : ''}</small>
                        </div>
                        <span class="inbox-result-badge event">Event</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            if (summary.shopping.length > 0) {
                html += '<div class="inbox-result-section">';
                html += '<h4><i class="fas fa-shopping-cart"></i> Shopping Items (' + summary.shopping.length + ')</h4>';
                summary.shopping.forEach(item => {
                    html += `<div class="inbox-result-item">
                        <div class="inbox-result-item-content">
                            <strong>${item.item}</strong><br>
                            <small>${item.category}</small>
                        </div>
                        <span class="inbox-result-badge shopping">Shopping</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            if (summary.contacts.length > 0) {
                html += '<div class="inbox-result-section">';
                html += '<h4><i class="fas fa-address-book"></i> Contacts (' + summary.contacts.length + ')</h4>';
                summary.contacts.forEach(contact => {
                    html += `<div class="inbox-result-item">
                        <div class="inbox-result-item-content">
                            <strong>${contact.name}</strong><br>
                            <small>${contact.phone || contact.email}</small>
                        </div>
                        <span class="inbox-result-badge contact">Contact</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            if (summary.expenses.length > 0) {
                html += '<div class="inbox-result-section">';
                html += '<h4><i class="fas fa-wallet"></i> Expenses (' + summary.expenses.length + ')</h4>';
                summary.expenses.forEach(expense => {
                    html += `<div class="inbox-result-item">
                        <div class="inbox-result-item-content">
                            <strong>${expense.description}</strong><br>
                            <small>$${expense.amount.toFixed(2)}</small>
                        </div>
                        <span class="inbox-result-badge expense">Expense</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            results.innerHTML = html;
            results.classList.add('active');
        }

        // ==================== GOOGLE CALENDAR INTEGRATION ====================
        let googleCalendarEnabled = false;
        let gapiInited = false;
        let gisInited = false;
        let tokenClient;
        let accessToken = null;
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/calendar.events';

        function initGoogleCalendar() {
            const clientId = localStorage.getItem('gcalClientId');
            if (!clientId) {
                return;
            }

            // Initialize Google API client
            gapi.load('client', async () => {
                await gapi.client.init({
                    discoveryDocs: [DISCOVERY_DOC],
                });
                gapiInited = true;
                maybeEnableGoogleCalendar();
            });

            // Initialize Google Identity Services
            if (typeof google !== 'undefined' && google.accounts) {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: clientId,
                    scope: SCOPES,
                    callback: (response) => {
                        if (response.error !== undefined) {
                            showToast('Failed to authorize Google Calendar', 'error');
                            return;
                        }
                        accessToken = response.access_token;
                        updateGcalStatus(true);
                        syncWithGoogleCalendar();
                        showToast('Connected to Google Calendar!', 'success');
                    },
                });
                gisInited = true;
                maybeEnableGoogleCalendar();
            }
        }

        function maybeEnableGoogleCalendar() {
            if (gapiInited && gisInited) {
                const clientId = localStorage.getItem('gcalClientId');
                if (clientId) {
                    googleCalendarEnabled = true;
                }
            }
        }

        function saveGoogleCalendarConfig() {
            const clientId = document.getElementById('gcalClientId').value.trim();
            if (!clientId) {
                showToast('Please enter a valid Client ID', 'error');
                return;
            }
            
            localStorage.setItem('gcalClientId', clientId);
            document.getElementById('gcalSetupCard').style.display = 'none';
            showToast('Google Calendar configuration saved!', 'success');
            
            // Reload to initialize with new config
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        function hideGcalSetup() {
            document.getElementById('gcalSetupCard').style.display = 'none';
            localStorage.setItem('gcalSetupDismissed', 'true');
        }

        function toggleGoogleCalendarSync() {
            const clientId = localStorage.getItem('gcalClientId');
            
            if (!clientId) {
                document.getElementById('gcalSetupCard').style.display = 'block';
                document.getElementById('gcalSetupCard').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            if (!accessToken) {
                // Request authorization
                if (tokenClient) {
                    tokenClient.requestAccessToken();
                } else {
                    showToast('Google Calendar is still initializing...', 'warning');
                }
            } else {
                // Disconnect
                if (confirm('Disconnect from Google Calendar?')) {
                    accessToken = null;
                    updateGcalStatus(false);
                    showToast('Disconnected from Google Calendar', 'success');
                }
            }
        }

        function updateGcalStatus(connected) {
            const statusDiv = document.getElementById('gcalSyncStatus');
            const button = document.getElementById('gcalSyncButton');
            const indicator = statusDiv.querySelector('.gcal-sync-indicator');
            const statusText = statusDiv.querySelector('span');
            
            if (connected) {
                statusDiv.classList.remove('disconnected');
                statusDiv.classList.add('connected');
                indicator.classList.add('active');
                statusText.textContent = 'Google Calendar: Connected';
                button.innerHTML = '<i class="fab fa-google"></i> Disconnect';
            } else {
                statusDiv.classList.remove('connected');
                statusDiv.classList.add('disconnected');
                indicator.classList.remove('active');
                statusText.textContent = 'Google Calendar: Disconnected';
                button.innerHTML = '<i class="fab fa-google"></i> Connect Google';
            }
        }

        async function syncWithGoogleCalendar() {
            if (!accessToken) return;
            
            try {
                // Fetch events from Google Calendar (next 30 days)
                const timeMin = new Date().toISOString();
                const timeMax = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString();
                
                const response = await gapi.client.calendar.events.list({
                    calendarId: 'primary',
                    timeMin: timeMin,
                    timeMax: timeMax,
                    showDeleted: false,
                    singleEvents: true,
                    orderBy: 'startTime'
                });

                const googleEvents = response.result.items || [];
                
                // Import Google Calendar events that don't exist locally
                let importedCount = 0;
                googleEvents.forEach(gEvent => {
                    const eventExists = data.events.some(e => e.gcalId === gEvent.id);
                    if (!eventExists) {
                        const startDateTime = gEvent.start.dateTime || gEvent.start.date;
                        const date = new Date(startDateTime);
                        
                        data.events.push({
                            id: Date.now() + Math.random(),
                            gcalId: gEvent.id,
                            name: gEvent.summary || 'Untitled Event',
                            date: date.toISOString().split('T')[0],
                            time: gEvent.start.dateTime ? date.toTimeString().slice(0, 5) : '',
                            members: [],
                            location: gEvent.location || '',
                            notes: gEvent.description || '',
                            createdAt: Date.now()
                        });
                        importedCount++;
                    }
                });

                // Push local events to Google Calendar
                let exportedCount = 0;
                for (const event of data.events) {
                    if (!event.gcalId) {
                        const gcalEvent = await createGoogleCalendarEvent(event);
                        if (gcalEvent) {
                            event.gcalId = gcalEvent.id;
                            exportedCount++;
                        }
                    }
                }

                saveData();
                renderCalendar();
                renderEvents();
                
                if (importedCount > 0 || exportedCount > 0) {
                    showToast(`Synced: ${importedCount} imported, ${exportedCount} exported`, 'success');
                } else {
                    showToast('Calendar is up to date', 'success');
                }
            } catch (error) {
                console.error('Sync error:', error);
                showToast('Sync failed. Please try again.', 'error');
            }
        }

        async function createGoogleCalendarEvent(event) {
            if (!accessToken) return null;
            
            try {
                const startDateTime = event.time 
                    ? `${event.date}T${event.time}:00` 
                    : event.date;
                
                const endDateTime = event.time
                    ? new Date(new Date(`${event.date}T${event.time}:00`).getTime() + 60 * 60 * 1000).toISOString().slice(0, 16)
                    : event.date;

                const gcalEvent = {
                    summary: event.name,
                    location: event.location || '',
                    description: event.notes || '',
                    start: event.time 
                        ? { dateTime: startDateTime, timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone }
                        : { date: event.date },
                    end: event.time
                        ? { dateTime: endDateTime, timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone }
                        : { date: event.date }
                };

                const response = await gapi.client.calendar.events.insert({
                    calendarId: 'primary',
                    resource: gcalEvent
                });

                return response.result;
            } catch (error) {
                console.error('Failed to create Google Calendar event:', error);
                return null;
            }
        }

        async function updateGoogleCalendarEvent(event) {
            if (!accessToken || !event.gcalId) return;
            
            try {
                const startDateTime = event.time 
                    ? `${event.date}T${event.time}:00` 
                    : event.date;
                
                const endDateTime = event.time
                    ? new Date(new Date(`${event.date}T${event.time}:00`).getTime() + 60 * 60 * 1000).toISOString().slice(0, 16)
                    : event.date;

                const gcalEvent = {
                    summary: event.name,
                    location: event.location || '',
                    description: event.notes || '',
                    start: event.time 
                        ? { dateTime: startDateTime, timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone }
                        : { date: event.date },
                    end: event.time
                        ? { dateTime: endDateTime, timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone }
                        : { date: event.date }
                };

                await gapi.client.calendar.events.update({
                    calendarId: 'primary',
                    eventId: event.gcalId,
                    resource: gcalEvent
                });
            } catch (error) {
                console.error('Failed to update Google Calendar event:', error);
            }
        }

        async function deleteGoogleCalendarEvent(gcalId) {
            if (!accessToken || !gcalId) return;
            
            try {
                await gapi.client.calendar.events.delete({
                    calendarId: 'primary',
                    eventId: gcalId
                });
            } catch (error) {
                console.error('Failed to delete Google Calendar event:', error);
            }
        }

        // ==================== END GOOGLE CALENDAR INTEGRATION ====================

        // ==================== NOTES FUNCTIONALITY ====================
        function renderNotes() {
            const notesGrid = document.getElementById('notesGrid');
            const searchTerm = document.getElementById('noteSearch')?.value.toLowerCase() || '';
            
            let filteredNotes = data.notes;
            if (searchTerm) {
                filteredNotes = data.notes.filter(note => 
                    note.title.toLowerCase().includes(searchTerm) ||
                    note.content.toLowerCase().includes(searchTerm)
                );
            }

            if (filteredNotes.length === 0) {
                notesGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-sticky-note"></i>
                        <h3>No notes found</h3>
                        <p>Create your first note to get started</p>
                    </div>
                `;
                return;
            }

            notesGrid.innerHTML = filteredNotes.map(note => {
                const date = new Date(note.createdAt);
                const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                
                return `
                    <div class="note-card" onclick="openNoteModal(${note.id})">
                        <div class="note-card-header">
                            <div>
                                <div class="note-card-title">${note.title}</div>
                                <div class="note-card-date">${formattedDate}</div>
                            </div>
                        </div>
                        <div class="note-card-content">${note.content || '<em>No content</em>'}</div>
                        ${note.attachments && note.attachments.length > 0 ? `
                            <div class="note-card-attachments">
                                ${note.attachments.slice(0, 3).map(att => {
                                    if (att.type.startsWith('image/')) {
                                        return `<img src="${att.data}" class="note-attachment-preview" alt="${att.name}">`;
                                    } else {
                                        return `<div class="note-attachment-file"><i class="fas fa-file"></i> ${att.name}</div>`;
                                    }
                                }).join('')}
                                ${note.attachments.length > 3 ? `<div class="note-attachment-file">+${note.attachments.length - 3} more</div>` : ''}
                            </div>
                        ` : ''}
                        <div class="note-card-actions" onclick="event.stopPropagation();">
                            <button class="icon-btn" onclick="openNoteModal(${note.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn danger" onclick="deleteNote(${note.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function searchNotes() {
            renderNotes();
        }

        function openNoteModal(noteId = null) {
            const modal = document.getElementById('noteModal');
            const form = document.getElementById('noteForm');
            const attachmentsList = document.getElementById('noteAttachmentsList');
            form.reset();
            currentNoteAttachments = [];
            attachmentsList.innerHTML = '';
            
            if (noteId) {
                const note = data.notes.find(n => n.id === noteId);
                if (note) {
                    document.getElementById('noteModalTitle').textContent = 'Edit Note';
                    document.getElementById('noteId').value = note.id;
                    document.getElementById('noteTitle').value = note.title;
                    document.getElementById('noteContent').value = note.content;
                    currentNoteAttachments = note.attachments || [];
                    renderNoteAttachments();
                }
            } else {
                document.getElementById('noteModalTitle').textContent = 'New Note';
                document.getElementById('noteId').value = '';
            }
            
            modal.classList.add('active');
        }

        function handleNoteAttachments(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                // Check file size (max 5MB per file)
                if (file.size > 5 * 1024 * 1024) {
                    showToast(`File ${file.name} is too large (max 5MB)`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    currentNoteAttachments.push({
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: e.target.result
                    });
                    renderNoteAttachments();
                };
                reader.readAsDataURL(file);
            });

            // Reset input
            event.target.value = '';
        }

        function renderNoteAttachments() {
            const attachmentsList = document.getElementById('noteAttachmentsList');
            
            if (currentNoteAttachments.length === 0) {
                attachmentsList.innerHTML = '<p style="text-align: center; color: var(--text-light); font-size: 13px;">No attachments yet</p>';
                return;
            }

            attachmentsList.innerHTML = currentNoteAttachments.map((att, index) => {
                const sizeKB = (att.size / 1024).toFixed(1);
                const isImage = att.type.startsWith('image/');
                
                return `
                    <div class="note-attachment-item">
                        <div class="note-attachment-info">
                            ${isImage ? 
                                `<img src="${att.data}" class="note-attachment-thumbnail" alt="${att.name}">` :
                                `<div class="note-attachment-icon"><i class="fas fa-file"></i></div>`
                            }
                            <div class="note-attachment-details">
                                <div class="note-attachment-name">${att.name}</div>
                                <div class="note-attachment-size">${sizeKB} KB</div>
                            </div>
                        </div>
                        <button type="button" class="icon-btn danger" onclick="removeNoteAttachment(${index})" title="Remove">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }

        function removeNoteAttachment(index) {
            currentNoteAttachments.splice(index, 1);
            renderNoteAttachments();
        }

        function saveNote(e) {
            e.preventDefault();
            
            const noteId = document.getElementById('noteId').value;
            const note = {
                id: noteId ? parseInt(noteId) : Date.now(),
                title: document.getElementById('noteTitle').value,
                content: document.getElementById('noteContent').value,
                attachments: currentNoteAttachments,
                createdAt: noteId ? data.notes.find(n => n.id === parseInt(noteId)).createdAt : Date.now(),
                updatedAt: Date.now()
            };

            if (noteId) {
                const index = data.notes.findIndex(n => n.id === parseInt(noteId));
                data.notes[index] = note;
                addActivity('note', `Updated note: ${note.title}`);
            } else {
                data.notes.push(note);
                addActivity('note', `Created note: ${note.title}`);
            }

            saveData();
            renderNotes();
            closeModal('noteModal');
            showToast('Note saved successfully!', 'success');
        }

        function deleteNote(noteId) {
            if (confirm('Are you sure you want to delete this note?')) {
                const note = data.notes.find(n => n.id === noteId);
                data.notes = data.notes.filter(n => n.id !== noteId);
                saveData();
                renderNotes();
                addActivity('note', `Deleted note: ${note.title}`);
                showToast('Note deleted', 'success');
            }
        }
        // ==================== END NOTES FUNCTIONALITY ====================

        // ==================== VEHICLES FUNCTIONALITY ====================
        function renderVehicles() {
            const vehiclesGrid = document.getElementById('vehiclesGrid');
            
            if (data.vehicles.length === 0) {
                vehiclesGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-car"></i>
                        <h3>No vehicles added</h3>
                        <p>Add your first vehicle to track maintenance</p>
                    </div>
                `;
                return;
            }

            vehiclesGrid.innerHTML = data.vehicles.map(vehicle => {
                const vehicleTitle = `${vehicle.year} ${vehicle.make} ${vehicle.model}`;
                const maintenanceRecords = vehicle.maintenanceRecords || [];
                const sortedRecords = [...maintenanceRecords].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                return `
                    <div class="vehicle-card">
                        <div class="vehicle-card-header">
                            <div>
                                <div class="vehicle-card-title">${vehicleTitle}</div>
                                <div class="vehicle-card-subtitle">${vehicle.color || 'Color not specified'}</div>
                            </div>
                            <div class="vehicle-card-actions">
                                <button class="icon-btn" onclick="openVehicleModal(${vehicle.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="icon-btn danger" onclick="deleteVehicle(${vehicle.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="vehicle-card-info">
                            ${vehicle.vin ? `
                                <div class="vehicle-info-item">
                                    <div class="vehicle-info-label">VIN</div>
                                    <div class="vehicle-info-value">${vehicle.vin}</div>
                                </div>
                            ` : ''}
                            ${vehicle.plate ? `
                                <div class="vehicle-info-item">
                                    <div class="vehicle-info-label">License Plate</div>
                                    <div class="vehicle-info-value">${vehicle.plate}</div>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${vehicle.notes ? `<p style="color: var(--text); font-size: 13px; margin-bottom: 16px;">${vehicle.notes}</p>` : ''}
                        
                        <div class="maintenance-records-section">
                            <div class="maintenance-records-header">
                                <h4><i class="fas fa-wrench"></i> Maintenance Records (${maintenanceRecords.length})</h4>
                                <button class="btn btn-sm btn-primary" onclick="openMaintenanceRecordModal(${vehicle.id})">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            
                            ${sortedRecords.length > 0 ? sortedRecords.slice(0, 5).map(record => `
                                <div class="maintenance-record-item">
                                    <div class="maintenance-record-info">
                                        <div class="maintenance-record-date">${formatDate(record.date)}</div>
                                        <div class="maintenance-record-odometer"><i class="fas fa-tachometer-alt"></i> ${record.odometer.toLocaleString()} miles</div>
                                        <div class="maintenance-record-description">${record.description}</div>
                                    </div>
                                    <div class="maintenance-record-actions">
                                        <button class="icon-btn danger" onclick="deleteMaintenanceRecord(${vehicle.id}, ${record.id})" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('') : '<p style="text-align: center; color: var(--text-light); font-size: 13px; padding: 12px;">No maintenance records yet</p>'}
                            
                            ${sortedRecords.length > 5 ? `<p style="text-align: center; color: var(--text-light); font-size: 12px; margin-top: 8px;">+${sortedRecords.length - 5} more records</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openVehicleModal(vehicleId = null) {
            const modal = document.getElementById('vehicleModal');
            const form = document.getElementById('vehicleForm');
            form.reset();
            
            if (vehicleId) {
                const vehicle = data.vehicles.find(v => v.id === vehicleId);
                if (vehicle) {
                    document.getElementById('vehicleModalTitle').textContent = 'Edit Vehicle';
                    document.getElementById('vehicleId').value = vehicle.id;
                    document.getElementById('vehicleYear').value = vehicle.year;
                    document.getElementById('vehicleMake').value = vehicle.make;
                    document.getElementById('vehicleModel').value = vehicle.model;
                    document.getElementById('vehicleColor').value = vehicle.color || '';
                    document.getElementById('vehicleVin').value = vehicle.vin || '';
                    document.getElementById('vehiclePlate').value = vehicle.plate || '';
                    document.getElementById('vehicleNotes').value = vehicle.notes || '';
                }
            } else {
                document.getElementById('vehicleModalTitle').textContent = 'Add Vehicle';
                document.getElementById('vehicleId').value = '';
            }
            
            modal.classList.add('active');
        }

        function saveVehicle(e) {
            e.preventDefault();
            
            const vehicleId = document.getElementById('vehicleId').value;
            
            // Get existing maintenance records if editing
            let existingMaintenanceRecords = [];
            let existingCreatedAt = Date.now();
            if (vehicleId) {
                const existingVehicle = data.vehicles.find(v => v.id === parseInt(vehicleId));
                if (existingVehicle) {
                    existingMaintenanceRecords = existingVehicle.maintenanceRecords || [];
                    existingCreatedAt = existingVehicle.createdAt || Date.now();
                }
            }
            
            const vehicle = {
                id: vehicleId ? parseInt(vehicleId) : Date.now(),
                year: document.getElementById('vehicleYear').value,
                make: document.getElementById('vehicleMake').value,
                model: document.getElementById('vehicleModel').value,
                color: document.getElementById('vehicleColor').value,
                vin: document.getElementById('vehicleVin').value,
                plate: document.getElementById('vehiclePlate').value,
                notes: document.getElementById('vehicleNotes').value,
                maintenanceRecords: existingMaintenanceRecords,
                createdAt: existingCreatedAt
            };

            if (vehicleId) {
                const index = data.vehicles.findIndex(v => v.id === parseInt(vehicleId));
                data.vehicles[index] = vehicle;
                addActivity('vehicle', `Updated vehicle: ${vehicle.year} ${vehicle.make} ${vehicle.model}`);
            } else {
                data.vehicles.push(vehicle);
                addActivity('vehicle', `Added vehicle: ${vehicle.year} ${vehicle.make} ${vehicle.model}`);
            }

            saveData();
            renderVehicles();
            closeModal('vehicleModal');
            showToast('Vehicle saved successfully!', 'success');
        }

        function deleteVehicle(vehicleId) {
            if (confirm('Are you sure you want to delete this vehicle and all its maintenance records?')) {
                const vehicle = data.vehicles.find(v => v.id === vehicleId);
                data.vehicles = data.vehicles.filter(v => v.id !== vehicleId);
                saveData();
                renderVehicles();
                addActivity('vehicle', `Deleted vehicle: ${vehicle.year} ${vehicle.make} ${vehicle.model}`);
                showToast('Vehicle deleted', 'success');
            }
        }

        function openMaintenanceRecordModal(vehicleId, recordId = null) {
            const modal = document.getElementById('maintenanceRecordModal');
            const form = document.getElementById('maintenanceRecordForm');
            form.reset();
            
            document.getElementById('maintenanceRecordVehicleId').value = vehicleId;
            
            if (recordId) {
                const vehicle = data.vehicles.find(v => v.id === vehicleId);
                const record = vehicle.maintenanceRecords.find(r => r.id === recordId);
                if (record) {
                    document.getElementById('maintenanceRecordId').value = record.id;
                    document.getElementById('maintenanceRecordDate').value = record.date;
                    document.getElementById('maintenanceRecordOdometer').value = record.odometer;
                    document.getElementById('maintenanceRecordDescription').value = record.description;
                }
            } else {
                document.getElementById('maintenanceRecordId').value = '';
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('maintenanceRecordDate').value = today;
            }
            
            modal.classList.add('active');
        }

        function saveMaintenanceRecord(e) {
            e.preventDefault();
            
            const vehicleId = parseInt(document.getElementById('maintenanceRecordVehicleId').value);
            const recordId = document.getElementById('maintenanceRecordId').value;
            const vehicle = data.vehicles.find(v => v.id === vehicleId);
            
            if (!vehicle.maintenanceRecords) {
                vehicle.maintenanceRecords = [];
            }
            
            const record = {
                id: recordId ? parseInt(recordId) : Date.now(),
                date: document.getElementById('maintenanceRecordDate').value,
                odometer: parseInt(document.getElementById('maintenanceRecordOdometer').value),
                description: document.getElementById('maintenanceRecordDescription').value
            };

            if (recordId) {
                const index = vehicle.maintenanceRecords.findIndex(r => r.id === parseInt(recordId));
                vehicle.maintenanceRecords[index] = record;
                addActivity('vehicle', `Updated maintenance record for ${vehicle.year} ${vehicle.make} ${vehicle.model}`);
            } else {
                vehicle.maintenanceRecords.push(record);
                addActivity('vehicle', `Added maintenance record for ${vehicle.year} ${vehicle.make} ${vehicle.model}`);
            }

            saveData();
            renderVehicles();
            closeModal('maintenanceRecordModal');
            showToast('Maintenance record saved!', 'success');
        }

        function deleteMaintenanceRecord(vehicleId, recordId) {
            if (confirm('Are you sure you want to delete this maintenance record?')) {
                const vehicle = data.vehicles.find(v => v.id === vehicleId);
                vehicle.maintenanceRecords = vehicle.maintenanceRecords.filter(r => r.id !== recordId);
                saveData();
                renderVehicles();
                addActivity('vehicle', `Deleted maintenance record for ${vehicle.year} ${vehicle.make} ${vehicle.model}`);
                showToast('Maintenance record deleted', 'success');
            }
        }
        // ==================== END VEHICLES FUNCTIONALITY ====================

        window.onclick = function(event) {
            if (event.target.classList.contains(`modal`)) {
                event.target.classList.remove(`active`);
            }
        };

        if (localStorage.getItem(`darkMode`) === `true`) {
            document.body.classList.add(`dark-mode`);
            document.querySelector(`.dark-mode-toggle i`).className = `fas fa-sun`;
        }

        // Check if Google Calendar setup should be shown
        if (!localStorage.getItem('gcalClientId') && !localStorage.getItem('gcalSetupDismissed')) {
            setTimeout(() => {
                if (document.querySelector('#schedule').classList.contains('active')) {
                    document.getElementById('gcalSetupCard').style.display = 'block';
                }
            }, 2000);
        }

        // Initialize Google Calendar if configured
        setTimeout(() => {
            initGoogleCalendar();
        }, 1000);

        init();
    </script>
</body>
</html>
